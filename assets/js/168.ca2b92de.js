(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{499:function(s,e,a){"use strict";a.r(e);var t=a(3),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"安装k8s集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装k8s集群"}},[s._v("#")]),s._v(" 安装K8S集群")]),s._v(" "),e("p",[s._v("一共有三种安装方式：")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("minikube")]),s._v("\n只是一个 K8S 集群模拟器，只有一个节点的集群，只为"),e("strong",[s._v("测试")]),s._v("用，"),e("strong",[s._v("master 和 worker 都在一起")])]),s._v(" "),e("li",[e("strong",[s._v("直接用云平台 Kubernetes")]),s._v("\n可视化搭建，只需简单几步就可以创建好一个集群。\n优点：安装简单，生态齐全，负载均衡器、存储等都给你配套好，简单操作就搞定")]),s._v(" "),e("li",[e("strong",[s._v("裸机安装（Bare Metal）")]),s._v(" "),e("strong",[s._v("至少需要两台机器")]),s._v("（主节点、工作节点个一台），需要自己安装 Kubernetes 组件，配置会稍微麻烦点。\n可以到各云厂商按时租用服务器，费用低，用完就销毁。\n缺点：配置麻烦，缺少生态支持，例如负载均衡器、云存储。")])]),s._v(" "),e("h2",{attrs:{id:"minikube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minikube"}},[s._v("#")]),s._v(" Minikube")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://minikube.sigs.k8s.io/docs/start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("minikube官方文档"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"linux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[s._v("#")]),s._v(" Linux")]),s._v(" "),e("p",[s._v("以下以centos7为标准安装")]),s._v(" "),e("p",[e("strong",[s._v("必须先安装docker")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce docker-ce-cli containerd.io kubelet-1.24.1 kubectl-1.24.1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("systemctl start "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": ["https://o7uzc3zp.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("安装Minikube")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" minikube-linux-amd64 /usr/local/bin/minikube\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("将当前用户添加到docker组中")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -aG "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$USER")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" newgrp "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("关闭 swap 分区")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nswapoff -a\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭  ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释下面这行,或使用 sed 命令注释 sed -ri 's/.*swap.*/#&/' /etc/fstab")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/dev/mapper/centos-swap swap                    swap    defaults        0 0")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否关闭成功")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若都显示 0 则表示关闭成功，需要重启服务器生效，可以使用 reboot 或 shutdown -r now 命令重启")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node2 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# free -m")]),s._v("\n              total        used        "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v("      shared  buff/cache   available\nMem:           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3770")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("305")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3115")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3242")]),s._v("\nSwap:             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[e("strong",[s._v("开启 ipv4 转发")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("strong",[s._v("启动Minikube")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("minikube start\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如出现minikube和docker 冲突问题The “docker“ driver should not be used with root privileges.If you are running错误 请指定驱动为docker运行minikube")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者按查看当前用户是否在docker组中")]),s._v("\nminikube start --force --driver"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("当出现docker无法拉取 请尝试切换镜像源")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220625201730706.png",alt:"image-20220625201730706"}})]),s._v(" "),e("p",[s._v("先运行Minikube的删除")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("minikube delete\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("再执行切换源")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220625235329465.png",alt:"image-20220625235329465"}})]),s._v(" "),e("p",[s._v("显示 "),e("code",[s._v("正在使用镜像存储库 registry.cn-hangzhou.aliyuncs.com/google_containers")]),s._v(" 则成功")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将镜像源切为中国 默认为阿里云镜像 不一定能通 如不通可尝试下面另一个方法")]),s._v("\nminikube start --image-mirror-country"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cn\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将镜像源切为阿里云 启动")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#minikube start  --image-mirror-country=cn --image-repository='registry.cn-hangzhou.aliyuncs.com/google_containers' --base-image='registry.cn-hangzhou.aliyuncs.com/google_containers/kicbase:v0.0.28'")]),s._v("\nminikube start --image-repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'registry.cn-hangzhou.aliyuncs.com/google_containers'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("strong",[s._v("使用阿里云可能出现无法拉取的情况 需要修改dns")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/resolv.conf\n\nnameserver "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.5")]),s._v(".5.5\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("--driver=***")]),s._v(" 从1.5.0版本开始，Minikube缺省使用系统优选的驱动来创建Kubernetes本地环境，比如您已经安装过Docker环境，minikube 将使用 "),e("code",[s._v("docker")]),s._v(" 驱动")]),s._v(" "),e("li",[e("code",[s._v("--cpus=2")]),s._v(": 为minikube虚拟机分配CPU核数")]),s._v(" "),e("li",[e("code",[s._v("--memory=2048mb")]),s._v(": 为minikube虚拟机分配内存数")]),s._v(" "),e("li",[e("code",[s._v("--registry-mirror=***")]),s._v(" 为了提升拉取Docker Hub镜像的稳定性，可以为 Docker daemon 配置镜像加速，参考"),e("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云镜像服务"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("code",[s._v("--kubernetes-version=***")]),s._v(": minikube 虚拟机将使用的 kubernetes 版本")])]),s._v(" "),e("p",[e("strong",[s._v("安装kubectl")])]),s._v(" "),e("p",[e("a",{attrs:{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",target:"_blank",rel:"noopener noreferrer"}},[s._v("install-kubectl-linux"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -LO "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://dl.k8s.io/release/'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L -s https://dl.k8s.io/release/stable.txt"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('/bin/linux/amd64/kubectl"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\nkubectl --help\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"windwos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windwos"}},[s._v("#")]),s._v(" windwos")]),s._v(" "),e("p",[s._v("安装Minikube")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("New-Item")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Path "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Name "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'minikube'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ItemType Directory "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Force\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke-WebRequest")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("OutFile "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c:\\minikube\\minikube.exe'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Uri "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://github.com/kubernetes/minikube/releases/latest/download/minikube-windows-amd64.exe'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("UseBasicParsing\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("配置Minikube环境变量")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$oldPath")]),s._v(" = "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[Environment]")]),s._v("::GetEnvironmentVariable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Path'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[EnvironmentVariableTarget]")]),s._v("::Machine"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$oldPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Split"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("inotcontains "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C:\\minikube'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" `\n  "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[Environment]")]),s._v("::SetEnvironmentVariable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Path'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{0};C:\\minikube'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$oldPath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[EnvironmentVariableTarget]")]),s._v("::Machine"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" `\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"启动minikube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动minikube"}},[s._v("#")]),s._v(" 启动Minikube")]),s._v(" "),e("p",[s._v("重新打开终端 启动Minikube")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将镜像源切为中国 默认为阿里云镜像")]),s._v("\nminikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image-mirror-country=cn\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220625235329465.png",alt:"image-20220625235329465"}})]),s._v(" "),e("h3",{attrs:{id:"验证minikube"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证minikube"}},[s._v("#")]),s._v(" 验证Minikube")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Users\\Iekr> minikube version\nminikube version: v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("26"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0\ncommit: f4b412861bb746be73053c9f6d2895f12cf78565\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("查看kubectl版本号，第一次使用会直接安装kubectl")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Users\\Iekr> minikube kubectl version\n    > kubectl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sha256: 64 B "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 64 B "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 100"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("00% ? p/s 0s\n    > kubectl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe: 44"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("14 MiB "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 44"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("14 MiB "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 100"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("00% 16"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("58 MiB p/s 2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("9s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"云服务搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#云服务搭建"}},[s._v("#")]),s._v(" 云服务搭建")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://cloud.tencent.com/product/cvm?from=13950",target:"_blank",rel:"noopener noreferrer"}},[s._v("腾讯云 CVM"),e("OutboundLink")],1),s._v(" 弹性云服务器  此次学习我们使用这个")]),s._v(" "),e("li",[e("a",{attrs:{href:"https://cloud.tencent.com/product/tke",target:"_blank",rel:"noopener noreferrer"}},[s._v("腾讯云 TKE"),e("OutboundLink")],1),s._v("（控制台搜索容器）直接搭建好k8s")]),s._v(" "),e("li",[s._v("登录阿里云控制台 - 产品搜索 Kubernetes")])]),s._v(" "),e("p",[s._v("我们购买3台弹性云服务器 进行搭建学习")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220626162910460.png",alt:"image-20220626162910460"}})]),s._v(" "),e("h3",{attrs:{id:"裸机搭建-bare-metal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#裸机搭建-bare-metal"}},[s._v("#")]),s._v(" 裸机搭建（Bare Metal）")]),s._v(" "),e("h4",{attrs:{id:"主节点需要组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主节点需要组件"}},[s._v("#")]),s._v(" 主节点需要组件")]),s._v(" "),e("ul",[e("li",[s._v("docker（也可以是其他容器运行时）")]),s._v(" "),e("li",[s._v("kubectl 集群命令行交互工具")]),s._v(" "),e("li",[s._v("kubeadm 集群初始化工具")])]),s._v(" "),e("h4",{attrs:{id:"工作节点需要组件-文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工作节点需要组件-文档"}},[s._v("#")]),s._v(" 工作节点需要组件 "),e("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/overview/components/#node-components",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),e("OutboundLink")],1)]),s._v(" "),e("ul",[e("li",[s._v("docker（也可以是其他容器运行时）")]),s._v(" "),e("li",[s._v("kubelet 管理 Pod 和容器，确保他们健康稳定运行。")]),s._v(" "),e("li",[s._v("kube-proxy 网络代理，负责网络相关的工作")])]),s._v(" "),e("h4",{attrs:{id:"开始安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始安装"}},[s._v("#")]),s._v(" 开始安装")]),s._v(" "),e("blockquote",[e("p",[s._v("你也可以试下 "),e("a",{attrs:{href:"https://github.com/lework/kainstall",target:"_blank",rel:"noopener noreferrer"}},[s._v("这个项目"),e("OutboundLink")],1),s._v("，用脚本快速搭建 K8S 裸机集群\n当然，为了更好的理解，你应该先手动搭建一次")])]),s._v(" "),e("p",[e("strong",[s._v("以下命令操作所以节点都需要执行")])]),s._v(" "),e("p",[s._v("分别修改各个节点的主机名")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个节点分别设置对应主机名")]),s._v("\nhostnamectl set-hostname master\nhostnamectl set-hostname node1\nhostnamectl set-hostname node2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("修改hosts")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/hosts\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v(".0.14 master\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v(".0.7 node1\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v(".0.3 node2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("关闭所有节点的"),e("strong",[s._v("SELinux")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("setenforce "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i --follow-symlinks "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/SELINUX=enforcing/SELINUX=disabled/g'")]),s._v(" /etc/sysconfig/selinux\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("添加安装源（所有节点） "),e("strong",[s._v("注意这里是x86架构的源 如果你是arm架构请更换")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 k8s 安装源")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" kubernetes.repo /etc/yum.repos.d/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 Docker 安装源")]),s._v("\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("安装所需组件")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y kubelet kubeadm kubectl docker-ce")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看最新版本的k8s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL https://dl.k8s.io/release/stable.txt\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#目前最新版本是1.24.2，k8s1.24版本之后不再使用docker作为容器，因此我们暂不使用该版本，使用1.22.4版本进行安装")]),s._v("\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet-1.22.4 kubectl-1.22.4 kubeadm-1.22.4 docker-ce\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("启动 kubelet、docker，并设置开机启动（所有节点）")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\nsystemctl start kubelet\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\nsystemctl start "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("修改 docker 镜像源")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubernetes 官方推荐 docker 等使用 systemd 作为 cgroupdriver，否则 kubelet 启动不了")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" daemon.json")]),s._v('\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "registry-mirrors": ["https://ud6340vz.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" daemon.json /etc/docker/\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启生效")]),s._v("\nsystemctl daemon-reload\nsystemctl restart "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[e("strong",[s._v("用 "),e("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("kubeadm"),e("OutboundLink")],1),s._v(" 初始化集群（仅在主节点跑）")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化集群控制台 Control plane")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 失败了可以用 kubeadm reset 重置")]),s._v("\nkubeadm init --image-repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.aliyuncs.com/google_containers\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("如果重新 "),e("code",[s._v("/proc/sys/net/ipv4/ip_forward contents are not set to 1")]),s._v(" 错误 所有节点请打开ipv4转发")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("strong",[s._v("获取token")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得把 kubeadm join xxx 保存起来")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忘记了重新获取")]),s._v("\nkubeadm token create --print-join-command "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认 24h 过期")]),s._v("\nkubeadm token create --print-join-command --ttl"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#永不过期")]),s._v("\nkubeadm token list "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看是否有存活的 token")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220626175337443.png",alt:"image-20220626175337443"}})]),s._v(" "),e("p",[e("strong",[s._v("复制授权文件")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制授权文件，以便 kubectl 可以有权限访问集群")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果你其他节点需要访问集群，需要从主节点复制这个文件过去其他节点")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在其他机器上创建 ~/.kube/config 文件也能通过 kubectl 访问到集群")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" root@node1:/etc/kubernetes/admin.conf /etc/kubernetes/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" root@node2:/etc/kubernetes/admin.conf /etc/kubernetes/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("有兴趣了解 kubeadm init 具体做了什么的，可以 "),e("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看文档"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("strong",[s._v("如果报gprc错误可以修改一下配置")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/containerd/config.toml "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n[plugins."io.containerd.grpc.v1.cri"]\n  systemd_cgroup = true\nEOF')]),s._v("\nsystemctl restart containerd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("把工作节点加入集群（只在工作节点跑）")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.206")]),s._v(".0.14:6443 --token 9larxq.psnz2g88vzrah98p "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        --discovery-token-ca-cert-hash sha256:d03890b53bd63d025257174013752ee335487b54e7d89a291791d11950b94ff0 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("出现 "),e("code",[s._v("kubectl get nodes")]),s._v(" 则成功")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220626175626483.png",alt:"image-20220626175626483"}})]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl get nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220626175721228.png",alt:"image-20220626175721228"}})]),s._v(" "),e("p",[s._v("可以看见 几个node 都NotReady 状态 由于我们没有安装网络插件所以查看为 NotReady 状态")]),s._v(" "),e("p",[s._v("安装网络插件 "),e("strong",[s._v("在主节点中安装既可")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 很有可能国内网络访问不到这个资源，你可以网上找找国内的源安装 flannel")]),s._v("\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("安装成功后稍等片刻 再次 "),e("code",[s._v("kubectl get nodes")]),s._v(" 状态为Ready")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl get nodes\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220626183245800.png",alt:"image-20220626183245800"}})])])}),[],!1,null,null,null);e.default=n.exports}}]);