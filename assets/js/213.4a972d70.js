(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{543:function(s,a,n){"use strict";n.r(a);var t=n(3),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"入门案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入门案例"}},[s._v("#")]),s._v(" 入门案例")]),s._v(" "),a("h2",{attrs:{id:"netcat的发送和监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#netcat的发送和监听"}},[s._v("#")]),s._v(" netcat的发送和监听")]),s._v(" "),a("p",[s._v("安装")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装netcat工具")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tunlp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断44444端口是否被占用")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("使用nc发送和接受消息 此操作在一个机器上 2个ssh窗口中操作")]),s._v(" "),a("p",[s._v("接受")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -l "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听44444端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("发送")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" hadoop102 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送")]),s._v("\n输入内容\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("也可以在其他机器向指定ip 端口 发送消息")]),s._v(" "),a("p",[s._v("监听和发送的端口必须一致")]),s._v(" "),a("p",[s._v("默认为tcp协议")]),s._v(" "),a("h2",{attrs:{id:"监控端口数据在控制台输出-官方案例-netcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控端口数据在控制台输出-官方案例-netcat"}},[s._v("#")]),s._v(" 监控端口数据在控制台输出 官方案例 netcat")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#r1:表示a1的Source的名称 多个名称之前空格隔开")]),s._v("\na1.sources "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#k1:表示a1的Sink名称")]),s._v("\na1.sinks "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#c1:表示channels的名称")]),s._v("\na1.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的输入源类型为netcat端口类型")]),s._v("\na1.sources.r1.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的监听地址")]),s._v("\na1.sources.r1.bind "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的监听端口")]),s._v("\na1.sources.r1.port "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的输出目的地是控制台logger类型")]),s._v("\na1.sinks.k1.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel类型是memory内存型")]),s._v("\na1.channels.c1.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel总容量1000个event 默认为100")]),s._v("\na1.channels.c1.capacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel传输时收集到了100条event以后再去提交事务")]),s._v("\na1.channels.c1.transactionCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" \n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#声明source sink 和 channel 之间的关系")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将r1和c1连接起来")]),s._v("\na1.sources.r1.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将k1和c1连接起来 注意一个sink只能对应一个channel")]),s._v("\na1.sinks.k1.channel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211110210311722.png",alt:"image-20211110210311722"}})]),s._v(" "),a("p",[s._v("在/opt/module/flume下启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("flume-ng agent --conf conf/ --name a1 --conf-file datas/netcatsource_loggersink.conf -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或")]),s._v("\nflume-ng agent -c conf/ -n a1 -f job/flume-netcat-logger.conf -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("--conf/-c：表示配置文件存储在conf/目录")]),s._v(" "),a("li",[s._v("--name/-n：表示给agent起名为a1")]),s._v(" "),a("li",[s._v("--conf-file/-f：flume本次启动读取的配置文件是在job文件夹下的flume-telnet.conf文件。")]),s._v(" "),a("li",[s._v("-Dflume.root.logger=INFO,console ：-D表示flume运行时动态修改flume.root.logger参数属性值，并将控制台日志打印级别设置为INFO级别。日志级别包括:log、info、warn、error。")])]),s._v(" "),a("p",[s._v("在另外一个ssh窗口中使用netcat发送消息")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#地址为配置文件中配置的地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入文字")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置log4j-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置log4j-properties"}},[s._v("#")]),s._v(" 配置log4j.properties")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/flume/conf/log4j.properties \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flume.root.logger=DEBUG,console")]),s._v("\nflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,LOGFILE "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志级别 和 输出位置")]),s._v("\nflume.log.dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./logs "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log文件存放路径")]),s._v("\nflume.log.file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("flume.log  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log文件名")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"实时监控单个追加文件到hdfs案例-exec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时监控单个追加文件到hdfs案例-exec"}},[s._v("#")]),s._v(" 实时监控单个追加文件到HDFS案例 exec")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211111104221130.png",alt:"image-20211111104221130"}})]),s._v(" "),a("p",[s._v("创建案例配置文件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/datas\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" execsource_hdfssink.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sources")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("r2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("k2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.channels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c2")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听文件类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sources.r2.type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sources.r2.command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("tail -F /opt/module/flume/datas/123.log")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HDFS Sink")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("hdfs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果要使用时间转义序列 则需要开启本地时间戳 或者 在event中headers中带时间戳")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("hdfs://hadoop102:8020/flume/%Y%m%d/%H")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.filePrefix")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("logs-")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下面3个配置定义了多久时间单位创建一个新的文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.round")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.roundValue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.roundUnit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("hour")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.useLocalTimeStamp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.batchSize")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.fileType")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("DataStream")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件 秒为单位")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.rollInterval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("60")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小 字节单位")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.rollSize")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("134217700")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关 0为禁用 也可以设置为指定数 当Event到达一定数量则文件滚动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.hdfs.rollCount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.channels.c2.type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("memory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.channels.c2.capacity")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.channels.c2.transactionCapacity")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("100")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sources.r2.channels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("a2.sinks.k2.channel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("c2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nflume-ng agent -n a2 -c conf/ -f datas/execsource_hdfssink.conf -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/module/flume/datas/123.log "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#写入内容测试 hdfs上是否创建文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" ccc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/module/flume/datas/123.log "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#等待60s 追内容 是否滚动文件生成新的采集文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211111112640291.png",alt:"image-20211111112640291"}})]),s._v(" "),a("p",[s._v("当前正在写入的文件为tmp 只有滚动文件后次缓存文件会修改为普通文件")]),s._v(" "),a("h2",{attrs:{id:"实时监控目录下多个新文件到hdfs-spooldir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时监控目录下多个新文件到hdfs-spooldir"}},[s._v("#")]),s._v(" 实时监控目录下多个新文件到HDFS spooldir")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211111114002805.png",alt:"image-20211111114002805"}})]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" upload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" datas/flume-dir-hdfs.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("配置文件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("a3.sources "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r3\na3.sinks "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k3\na3.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听一个指定的文件夹 自动收集目录中的内容")]),s._v("\na3.sources.r3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" spooldir\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#目录 目录下的文件名不能相同 否则抛异常")]),s._v("\na3.sources.r3.spoolDir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/upload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果目录下的文件名读取完后 文件名相同 可以采取读取完后删除文件  默认为加后缀名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置为 immediate 读取完后删除 默认值为 never 保留")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#a3.sources.r3.deletePolicy = immediate")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#被读取完毕后的文件 后缀名被更改为    默认值为.COMPLETED")]),s._v("\na3.sources.r3.fileSuffix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .COMPLETED\n\na3.sources.r3.fileHeader "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#忽略所有以.tmp结尾的文件，不上传")]),s._v("\na3.sources.r3.ignorePattern "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3.sinks.k3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na3.sinks.k3.hdfs.path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:8020/flume2/upload/%Y%m%d/%H\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na3.sinks.k3.hdfs.filePrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na3.sinks.k3.hdfs.round "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na3.sinks.k3.hdfs.roundValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na3.sinks.k3.hdfs.roundUnit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na3.sinks.k3.hdfs.useLocalTimeStamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\na3.sinks.k3.hdfs.batchSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na3.sinks.k3.hdfs.fileType "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件")]),s._v("\na3.sinks.k3.hdfs.rollInterval "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小大概是128M")]),s._v("\na3.sinks.k3.hdfs.rollSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关")]),s._v("\na3.sinks.k3.hdfs.rollCount "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na3.channels.c3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c3.capacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c3.transactionCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3.sources.r3.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\na3.sinks.k3.channel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("flume-ng agent -n a3 -c conf/ -f datas/flume-dir-hdfs.conf -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建文本文件写入内容 移动到upload目录下")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" eee "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log upload/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"实时监控目录下的多个追加文件-taildir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实时监控目录下的多个追加文件-taildir"}},[s._v("#")]),s._v(" 实时监控目录下的多个追加文件 taildir")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211111171529662.png",alt:"image-20211111171529662"}})]),s._v(" "),a("p",[s._v("我们使用exec 读取单个文件追加内容时 如果flume挂掉后重新启动 会把文件从头到尾重新读取一遍 这是我们不希望的 而taildir读取多个文件追加内容时 "),a("strong",[s._v("会在positionFile 指定的json文件下")]),s._v(" "),a("strong",[s._v("保留读取过的文件位置")]),s._v(" 当flume挂掉重新上线后 读取json文件记录的位置 继续监控读取内容")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" files\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" datas/flume-taildir-hdfs.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("配置文件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("a3.sources "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r3\na3.sinks "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k3\na3.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sources类型")]),s._v("\na3.sources.r3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TAILDIR\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#taildir保存读取文件内容的位置 如果发生宕机会从该文件中读取上次读取到位置  默认为~/.flume/taildir_position.json")]),s._v("\na3.sources.r3.positionFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/tail_dir.json\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义组 不同组 指向不同文件 多个组之间空格隔开")]),s._v("\na3.sources.r3.filegroups "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1 f2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#f1组 监控指定目录下名字包含file的文件 正则表达式")]),s._v("\na3.sources.r3.filegroups.f1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/files/.*file.*\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#f2组 监控指定目录下名字包含的log的文件")]),s._v("\na3.sources.r3.filegroups.f2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/files/.*log.*\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3.sinks.k3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na3.sinks.k3.hdfs.path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:8020/flume/upload2/%Y%m%d/%H\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na3.sinks.k3.hdfs.filePrefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na3.sinks.k3.hdfs.round "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na3.sinks.k3.hdfs.roundValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na3.sinks.k3.hdfs.roundUnit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na3.sinks.k3.hdfs.useLocalTimeStamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\na3.sinks.k3.hdfs.batchSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na3.sinks.k3.hdfs.fileType "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件")]),s._v("\na3.sinks.k3.hdfs.rollInterval "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小大概是128M")]),s._v("\na3.sinks.k3.hdfs.rollSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关")]),s._v("\na3.sinks.k3.hdfs.rollCount "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na3.channels.c3.type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c3.capacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c3.transactionCapacity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3.sources.r3.channels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\na3.sinks.k3.channel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("p",[s._v("启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("flume-ng agent -n a3 -c conf/ -f datas/flume-taildir-hdfs.conf -Dflume.root.logger"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" files\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" file1.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" atguigu "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" log.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭flume 重新启动 查看是否还读取 aaa 和 bbb 字段")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);