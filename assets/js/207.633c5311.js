(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{541:function(s,t,a){"use strict";a.r(t);var e=a(3),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"压缩和存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压缩和存储"}},[s._v("#")]),s._v(" 压缩和存储")]),s._v(" "),t("h2",{attrs:{id:"压缩参数设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压缩参数设置"}},[s._v("#")]),s._v(" 压缩参数设置")]),s._v(" "),t("p",[s._v("要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("默认值")]),s._v(" "),t("th",[s._v("阶段")]),s._v(" "),t("th",[s._v("建议")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("io.compression.codecs    （在core-site.xml中配置）")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress.DefaultCodec,  org.apache.hadoop.io.compress.GzipCodec,  org.apache.hadoop.io.compress.BZip2Codec,  org.apache.hadoop.io.compress.Lz4Codec")]),s._v(" "),t("td",[s._v("输入压缩")]),s._v(" "),t("td",[s._v("Hadoop使用文件扩展名判断是否支持某种编解码器")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.map.output.compress")]),s._v(" "),t("td",[s._v("false")]),s._v(" "),t("td",[s._v("mapper输出")]),s._v(" "),t("td",[s._v("这个参数设为true启用压缩")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.map.output.compress.codec")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress.DefaultCodec")]),s._v(" "),t("td",[s._v("mapper输出")]),s._v(" "),t("td",[s._v("使用LZO、LZ4或snappy编解码器在此阶段压缩数据")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress")]),s._v(" "),t("td",[s._v("false")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("这个参数设为true启用压缩")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress.codec")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress. DefaultCodec")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("使用标准工具或者编解码器，如gzip和bzip2")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress.type")]),s._v(" "),t("td",[s._v("RECORD")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("SequenceFile输出使用的压缩类型：NONE和BLOCK")])])])]),s._v(" "),t("h2",{attrs:{id:"开启map输出阶段压缩-mr引擎"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启map输出阶段压缩-mr引擎"}},[s._v("#")]),s._v(" 开启map输出阶段压缩(MR引擎)")]),s._v(" "),t("p",[s._v("临时开启")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" hive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intermediate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开启hive中间传送的压缩功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" mapreduce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开启mapreduce中map输出压缩功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" mapreduce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("codec"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hadoop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SnappyCodec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置指定的压缩方式")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"开启reduce输出阶段压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启reduce输出阶段压缩"}},[s._v("#")]),s._v(" 开启Reduce输出阶段压缩")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" hive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开启hive最终输出数据压缩")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" mapreduce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileoutputformat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开启mapreduce最终输出数据压缩")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" mapreduce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileoutputformat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("codec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hadoop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SnappyCodec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置压缩方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" mapreduce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileoutputformat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("BLOCK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置mapreduce最终输出压缩方式")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"文件存储格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件存储格式"}},[s._v("#")]),s._v(" 文件存储格式")]),s._v(" "),t("p",[s._v("Hive支持的存储数据的格式主要有：")]),s._v(" "),t("p",[s._v("行存储 TEXTFILE 、SEQUENCEFILE")]),s._v(" "),t("p",[s._v("列存储 ORC、PARQUET  "),t("strong",[s._v("Hive中使用列存储比较好")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211109185028034.png",alt:"image-20211109185028034"}})]),s._v(" "),t("h2",{attrs:{id:"textfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#textfile"}},[s._v("#")]),s._v(" TEXTFILE")]),s._v(" "),t("p",[s._v("默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。")]),s._v(" "),t("h2",{attrs:{id:"orc格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#orc格式"}},[s._v("#")]),s._v(" Orc格式")]),s._v(" "),t("p",[s._v("Orc文件由1个或多个stripe组成，每个stripe一般为HDFS的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet中的row group的概念。每个Stripe里有三部分组成，分别是Index Data，Row Data，Stripe Footer：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211109185329421.png",alt:"image-20211109185329421"}})]),s._v(" "),t("p",[s._v("1）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该只是记录某行的各字段在Row Data中的offset。")]),s._v(" "),t("p",[s._v("2）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个列进行了编码，分成多个Stream来存储。")]),s._v(" "),t("p",[s._v("3）Stripe Footer：存的是各个Stream的类型，长度等信息。")]),s._v(" "),t("p",[s._v("每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后往前读。")]),s._v(" "),t("h2",{attrs:{id:"parquet格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parquet格式"}},[s._v("#")]),s._v(" Parquet格式")]),s._v(" "),t("p",[s._v("Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的数据和元数据，因此Parquet格式文件是自解析的。")]),s._v(" "),t("p",[s._v("（1）行组(Row Group)：每一个行组包含一定的行数，在一个HDFS文件中至少存储一个行组，类似于orc的stripe的概念。")]),s._v(" "),t("p",[s._v("（2）列块(Column Chunk)：在一个行组中每一列保存在一个列块中，行组中的所有列连续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的算法进行压缩。")]),s._v(" "),t("p",[s._v("（3）页(Page)：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块的不同页可能使用不同的编码方式。")]),s._v(" "),t("h2",{attrs:{id:"指定文件存储格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定文件存储格式"}},[s._v("#")]),s._v(" 指定文件存储格式")]),s._v(" "),t("h3",{attrs:{id:"textfile-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#textfile-2"}},[s._v("#")]),s._v(" textfile")]),s._v(" "),t("p",[s._v("在建表时通过stored 关键字指定格式")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_text "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" textfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 指定为textfile 默认也是textfile")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"orc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#orc"}},[s._v("#")]),s._v(" orc")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_orc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" orc  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 指定为orc格式")]),s._v("\ntblproperties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orc.compress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NONE"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 去掉压缩")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("只能插入数据 不能直接加数据文件")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_orc "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" log_text "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"parquet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parquet"}},[s._v("#")]),s._v(" parquet")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_parquet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" parquet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("插入数据")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_parquet "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" log_text "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"三种存储格式大小比较"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三种存储格式大小比较"}},[s._v("#")]),s._v(" 三种存储格式大小比较")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211109190508464.png",alt:"image-20211109190508464"}})]),s._v(" "),t("h2",{attrs:{id:"存储和压缩结合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储和压缩结合"}},[s._v("#")]),s._v(" 存储和压缩结合")]),s._v(" "),t("h3",{attrs:{id:"orc存储方式的压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#orc存储方式的压缩"}},[s._v("#")]),s._v(" orc存储方式的压缩")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Key")]),s._v(" "),t("th",[s._v("Default")]),s._v(" "),t("th",[s._v("Notes")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("orc.compress")]),s._v(" "),t("td",[s._v("ZLIB")]),s._v(" "),t("td",[s._v("high level  compression (one of NONE, ZLIB, SNAPPY)")])]),s._v(" "),t("tr",[t("td",[s._v("orc.compress.size")]),s._v(" "),t("td",[s._v("262,144")]),s._v(" "),t("td",[s._v("number of bytes  in each compression chunk")])]),s._v(" "),t("tr",[t("td",[s._v("orc.stripe.size")]),s._v(" "),t("td",[s._v("268,435,456")]),s._v(" "),t("td",[s._v("number of bytes in each stripe")])]),s._v(" "),t("tr",[t("td",[s._v("orc.row.index.stride")]),s._v(" "),t("td",[s._v("10,000")]),s._v(" "),t("td",[s._v("number of rows between index entries (must be >= 1000)")])]),s._v(" "),t("tr",[t("td",[s._v("orc.create.index")]),s._v(" "),t("td",[s._v("true")]),s._v(" "),t("td",[s._v("whether to create  row indexes")])]),s._v(" "),t("tr",[t("td",[s._v("orc.bloom.filter.columns")]),s._v(" "),t("td",[s._v('""')]),s._v(" "),t("td",[s._v("comma separated list of column names for which bloom filter should be  created")])]),s._v(" "),t("tr",[t("td",[s._v("orc.bloom.filter.fpp")]),s._v(" "),t("td",[s._v("0.05")]),s._v(" "),t("td",[s._v("false positive probability for bloom filter (must >0.0 and <1.0)")])])])]),s._v(" "),t("p",[s._v("所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现  在建表时指定")]),s._v(" "),t("h4",{attrs:{id:"zlib压缩格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zlib压缩格式"}},[s._v("#")]),s._v(" ZLIB压缩格式")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_zlib"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" orc  \ntblproperties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orc.compress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZLIB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 指定压缩为ZLIB 默认也为ZLIB")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("插入数据")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" log_orc_zlib "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" log_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"snappy压缩格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#snappy压缩格式"}},[s._v("#")]),s._v(" SNAPPY压缩格式")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_orc_snappy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" orc\ntblproperties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orc.compress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SNAPPY"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("插入数据")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" log_orc_snappy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" log_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"压缩后文件大小比较"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压缩后文件大小比较"}},[s._v("#")]),s._v(" 压缩后文件大小比较")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211109191148903.png",alt:"image-20211109191148903"}})]),s._v(" "),t("h3",{attrs:{id:"parquet存储方式的压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parquet存储方式的压缩"}},[s._v("#")]),s._v(" Parquet存储方式的压缩")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" log_par_snappy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\ntrack_time string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nurl string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nsession_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nreferer string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nip string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nend_user_id string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\ncity_id string\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" format delimited "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fields")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("terminated")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("\nstored "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" parquet\ntblproperties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parquet.compression"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SNAPPY"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" log_par_snappy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" log_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211109191516349.png",alt:"image-20211109191516349"}})]),s._v(" "),t("p",[s._v("未压缩和压缩之后文件大小")]),s._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一般选择snappy，lzo。")])])}),[],!1,null,null,null);t.default=r.exports}}]);