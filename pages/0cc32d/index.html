<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据采集模块 | Chiriri&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/twikoo@1.4.18/dist/twikoo.all.min.js"></script>
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="后端技术博客,专注后端学习与总结。Java,Spring,Scala,Hadoop,Spark,Flink,Python,Linux,Docker等技术文章。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="后端博客,个人技术博客,后端/前端开发,后端/前端框架,web前端,后端面试题,技术文档,学习,面试,Java,Scala,Hadoop,Spring,Spring Boot,Spring Cloud,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="code-PhM8VwEYco">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.9a8b5fd7.css" as="style"><link rel="preload" href="/assets/js/app.29dbd2a9.js" as="script"><link rel="preload" href="/assets/js/2.f9007d12.js" as="script"><link rel="preload" href="/assets/js/250.7aa4f12d.js" as="script"><link rel="preload" href="/assets/js/3.e376f0de.js" as="script"><link rel="preload" href="/assets/js/6.272c66f1.js" as="script"><link rel="prefetch" href="/assets/js/10.4e98354b.js"><link rel="prefetch" href="/assets/js/100.6266960c.js"><link rel="prefetch" href="/assets/js/101.298b2fe7.js"><link rel="prefetch" href="/assets/js/102.a0311400.js"><link rel="prefetch" href="/assets/js/103.a502e8d5.js"><link rel="prefetch" href="/assets/js/104.1229de5d.js"><link rel="prefetch" href="/assets/js/105.b47e8b84.js"><link rel="prefetch" href="/assets/js/106.609576e9.js"><link rel="prefetch" href="/assets/js/107.bffa14ac.js"><link rel="prefetch" href="/assets/js/108.9cc8cda3.js"><link rel="prefetch" href="/assets/js/109.9c311811.js"><link rel="prefetch" href="/assets/js/11.b5cf59df.js"><link rel="prefetch" href="/assets/js/110.530974f5.js"><link rel="prefetch" href="/assets/js/111.ca432296.js"><link rel="prefetch" href="/assets/js/112.615e3357.js"><link rel="prefetch" href="/assets/js/113.22f1520e.js"><link rel="prefetch" href="/assets/js/114.534d2bc3.js"><link rel="prefetch" href="/assets/js/115.80a99212.js"><link rel="prefetch" href="/assets/js/116.62999eba.js"><link rel="prefetch" href="/assets/js/117.d418c132.js"><link rel="prefetch" href="/assets/js/118.843a2b74.js"><link rel="prefetch" href="/assets/js/119.70bcf036.js"><link rel="prefetch" href="/assets/js/12.b6143c16.js"><link rel="prefetch" href="/assets/js/120.f3222ba5.js"><link rel="prefetch" href="/assets/js/121.6579a41d.js"><link rel="prefetch" href="/assets/js/122.2ac801f3.js"><link rel="prefetch" href="/assets/js/123.bedffd06.js"><link rel="prefetch" href="/assets/js/124.21ac4a8a.js"><link rel="prefetch" href="/assets/js/125.4a204abf.js"><link rel="prefetch" href="/assets/js/126.600745be.js"><link rel="prefetch" href="/assets/js/127.7ebccdcb.js"><link rel="prefetch" href="/assets/js/128.1672b0c2.js"><link rel="prefetch" href="/assets/js/129.affec4ae.js"><link rel="prefetch" href="/assets/js/13.8d14b4c2.js"><link rel="prefetch" href="/assets/js/130.563658c0.js"><link rel="prefetch" href="/assets/js/131.7bfcd46c.js"><link rel="prefetch" href="/assets/js/132.335b66f9.js"><link rel="prefetch" href="/assets/js/133.74557063.js"><link rel="prefetch" href="/assets/js/134.e0225b27.js"><link rel="prefetch" href="/assets/js/135.157b77d0.js"><link rel="prefetch" href="/assets/js/136.88fafee6.js"><link rel="prefetch" href="/assets/js/137.7bb98810.js"><link rel="prefetch" href="/assets/js/138.fb0fe7d1.js"><link rel="prefetch" href="/assets/js/139.aebfcbc7.js"><link rel="prefetch" href="/assets/js/14.5d82b4f7.js"><link rel="prefetch" href="/assets/js/140.2974fb08.js"><link rel="prefetch" href="/assets/js/141.b7464350.js"><link rel="prefetch" href="/assets/js/142.1c9b3463.js"><link rel="prefetch" href="/assets/js/143.771ee09e.js"><link rel="prefetch" href="/assets/js/144.9fe379ee.js"><link rel="prefetch" href="/assets/js/145.a9672570.js"><link rel="prefetch" href="/assets/js/146.c8f24041.js"><link rel="prefetch" href="/assets/js/147.a78db40c.js"><link rel="prefetch" href="/assets/js/148.77d0b91d.js"><link rel="prefetch" href="/assets/js/149.cf00f37c.js"><link rel="prefetch" href="/assets/js/15.24c5239e.js"><link rel="prefetch" href="/assets/js/150.c7cc1e47.js"><link rel="prefetch" href="/assets/js/151.d9699c13.js"><link rel="prefetch" href="/assets/js/152.717443d6.js"><link rel="prefetch" href="/assets/js/153.b7625e2b.js"><link rel="prefetch" href="/assets/js/154.e8367903.js"><link rel="prefetch" href="/assets/js/155.f33221d0.js"><link rel="prefetch" href="/assets/js/156.19abb49b.js"><link rel="prefetch" href="/assets/js/157.6af77cfb.js"><link rel="prefetch" href="/assets/js/158.e0a867d1.js"><link rel="prefetch" href="/assets/js/159.c30e35c2.js"><link rel="prefetch" href="/assets/js/16.c4f3e3e4.js"><link rel="prefetch" href="/assets/js/160.5d35c066.js"><link rel="prefetch" href="/assets/js/161.611228df.js"><link rel="prefetch" href="/assets/js/162.e3b0b41a.js"><link rel="prefetch" href="/assets/js/163.d523c20e.js"><link rel="prefetch" href="/assets/js/164.100b7873.js"><link rel="prefetch" href="/assets/js/165.1c2aed6a.js"><link rel="prefetch" href="/assets/js/166.fc656085.js"><link rel="prefetch" href="/assets/js/167.71f646fb.js"><link rel="prefetch" href="/assets/js/168.ca2b92de.js"><link rel="prefetch" href="/assets/js/169.3900de05.js"><link rel="prefetch" href="/assets/js/17.9c1a4a32.js"><link rel="prefetch" href="/assets/js/170.bf659812.js"><link rel="prefetch" href="/assets/js/171.c6b59084.js"><link rel="prefetch" href="/assets/js/172.c3d6eaab.js"><link rel="prefetch" href="/assets/js/173.293b7559.js"><link rel="prefetch" href="/assets/js/174.a03f3024.js"><link rel="prefetch" href="/assets/js/175.22e1de8c.js"><link rel="prefetch" href="/assets/js/176.573e3e96.js"><link rel="prefetch" href="/assets/js/177.9d0628d1.js"><link rel="prefetch" href="/assets/js/178.db90c255.js"><link rel="prefetch" href="/assets/js/179.96d8d310.js"><link rel="prefetch" href="/assets/js/18.fe59606a.js"><link rel="prefetch" href="/assets/js/180.5591b005.js"><link rel="prefetch" href="/assets/js/181.1b840d27.js"><link rel="prefetch" href="/assets/js/182.330b2c1b.js"><link rel="prefetch" href="/assets/js/183.d0b2fe6a.js"><link rel="prefetch" href="/assets/js/184.5cf31bdd.js"><link rel="prefetch" href="/assets/js/185.03d60f79.js"><link rel="prefetch" href="/assets/js/186.1e1a57b4.js"><link rel="prefetch" href="/assets/js/187.9a64023b.js"><link rel="prefetch" href="/assets/js/188.bb8cba15.js"><link rel="prefetch" href="/assets/js/189.0f5c0f2a.js"><link rel="prefetch" href="/assets/js/19.6c800f06.js"><link rel="prefetch" href="/assets/js/190.6e1110e3.js"><link rel="prefetch" href="/assets/js/191.c640512d.js"><link rel="prefetch" href="/assets/js/192.e7ef6a94.js"><link rel="prefetch" href="/assets/js/193.d29ab3a1.js"><link rel="prefetch" href="/assets/js/194.3fe142de.js"><link rel="prefetch" href="/assets/js/195.f7975e88.js"><link rel="prefetch" href="/assets/js/196.e9dc3889.js"><link rel="prefetch" href="/assets/js/197.22268c3a.js"><link rel="prefetch" href="/assets/js/198.1702fe91.js"><link rel="prefetch" href="/assets/js/199.99c32008.js"><link rel="prefetch" href="/assets/js/20.63aa5108.js"><link rel="prefetch" href="/assets/js/200.260580b9.js"><link rel="prefetch" href="/assets/js/201.02135380.js"><link rel="prefetch" href="/assets/js/202.2a3d3d5d.js"><link rel="prefetch" href="/assets/js/203.88d65f8a.js"><link rel="prefetch" href="/assets/js/204.a20e650f.js"><link rel="prefetch" href="/assets/js/205.ab78be57.js"><link rel="prefetch" href="/assets/js/206.a7400f4c.js"><link rel="prefetch" href="/assets/js/207.633c5311.js"><link rel="prefetch" href="/assets/js/208.ed2745ff.js"><link rel="prefetch" href="/assets/js/209.4fd1d142.js"><link rel="prefetch" href="/assets/js/21.1f98f87f.js"><link rel="prefetch" href="/assets/js/210.afba4295.js"><link rel="prefetch" href="/assets/js/211.8c8045aa.js"><link rel="prefetch" href="/assets/js/212.06d74917.js"><link rel="prefetch" href="/assets/js/213.4a972d70.js"><link rel="prefetch" href="/assets/js/214.c299feba.js"><link rel="prefetch" href="/assets/js/215.a896b009.js"><link rel="prefetch" href="/assets/js/216.f3bde1cb.js"><link rel="prefetch" href="/assets/js/217.3b546a39.js"><link rel="prefetch" href="/assets/js/218.6b8ea6d2.js"><link rel="prefetch" href="/assets/js/219.6a1cc006.js"><link rel="prefetch" href="/assets/js/22.fedd37b4.js"><link rel="prefetch" href="/assets/js/220.7d2adbd5.js"><link rel="prefetch" href="/assets/js/221.e6104fc7.js"><link rel="prefetch" href="/assets/js/222.e99cf5e0.js"><link rel="prefetch" href="/assets/js/223.49c9dc84.js"><link rel="prefetch" href="/assets/js/224.2ab83e3e.js"><link rel="prefetch" href="/assets/js/225.32e3235e.js"><link rel="prefetch" href="/assets/js/226.ebd1f7a6.js"><link rel="prefetch" href="/assets/js/227.b99db404.js"><link rel="prefetch" href="/assets/js/228.5e8db321.js"><link rel="prefetch" href="/assets/js/229.d5d3830a.js"><link rel="prefetch" href="/assets/js/23.6218c52a.js"><link rel="prefetch" href="/assets/js/230.627010ea.js"><link rel="prefetch" href="/assets/js/231.64ecbb95.js"><link rel="prefetch" href="/assets/js/232.45cda513.js"><link rel="prefetch" href="/assets/js/233.450f9fea.js"><link rel="prefetch" href="/assets/js/234.e15cb401.js"><link rel="prefetch" href="/assets/js/235.c3346c4e.js"><link rel="prefetch" href="/assets/js/236.72953f9c.js"><link rel="prefetch" href="/assets/js/237.8fd5f18f.js"><link rel="prefetch" href="/assets/js/238.c0897f8b.js"><link rel="prefetch" href="/assets/js/239.1f372cc4.js"><link rel="prefetch" href="/assets/js/24.bddcddc2.js"><link rel="prefetch" href="/assets/js/240.ba157c15.js"><link rel="prefetch" href="/assets/js/241.8d8e537b.js"><link rel="prefetch" href="/assets/js/242.e15b0b0e.js"><link rel="prefetch" href="/assets/js/243.8a65b213.js"><link rel="prefetch" href="/assets/js/244.cca05c48.js"><link rel="prefetch" href="/assets/js/245.9fbe8c33.js"><link rel="prefetch" href="/assets/js/246.2f271b14.js"><link rel="prefetch" href="/assets/js/247.5371ff6a.js"><link rel="prefetch" href="/assets/js/248.87946669.js"><link rel="prefetch" href="/assets/js/249.6e6169d3.js"><link rel="prefetch" href="/assets/js/25.77a69adb.js"><link rel="prefetch" href="/assets/js/251.586b450f.js"><link rel="prefetch" href="/assets/js/252.7f0d5f0b.js"><link rel="prefetch" href="/assets/js/253.40db6d94.js"><link rel="prefetch" href="/assets/js/254.1133e4e9.js"><link rel="prefetch" href="/assets/js/255.77d37d29.js"><link rel="prefetch" href="/assets/js/256.c382c06b.js"><link rel="prefetch" href="/assets/js/257.eedcaffb.js"><link rel="prefetch" href="/assets/js/258.ac9a90e8.js"><link rel="prefetch" href="/assets/js/259.66cbdb37.js"><link rel="prefetch" href="/assets/js/26.f577fdb3.js"><link rel="prefetch" href="/assets/js/260.7df0854f.js"><link rel="prefetch" href="/assets/js/261.72cfc101.js"><link rel="prefetch" href="/assets/js/262.0b1e07c7.js"><link rel="prefetch" href="/assets/js/263.e85b1a7f.js"><link rel="prefetch" href="/assets/js/264.1eeada2f.js"><link rel="prefetch" href="/assets/js/265.eded8239.js"><link rel="prefetch" href="/assets/js/266.3694071f.js"><link rel="prefetch" href="/assets/js/267.447a06c6.js"><link rel="prefetch" href="/assets/js/268.144c955f.js"><link rel="prefetch" href="/assets/js/269.6b273936.js"><link rel="prefetch" href="/assets/js/27.3d250d79.js"><link rel="prefetch" href="/assets/js/270.386b8749.js"><link rel="prefetch" href="/assets/js/271.cf7e15cc.js"><link rel="prefetch" href="/assets/js/272.9591aeec.js"><link rel="prefetch" href="/assets/js/273.e15a84e7.js"><link rel="prefetch" href="/assets/js/274.54b6ec70.js"><link rel="prefetch" href="/assets/js/275.c7952985.js"><link rel="prefetch" href="/assets/js/276.a5534c37.js"><link rel="prefetch" href="/assets/js/277.c4cee912.js"><link rel="prefetch" href="/assets/js/278.1b146e16.js"><link rel="prefetch" href="/assets/js/279.8ed7bf82.js"><link rel="prefetch" href="/assets/js/28.540d3cee.js"><link rel="prefetch" href="/assets/js/280.65e363fa.js"><link rel="prefetch" href="/assets/js/281.17460dfe.js"><link rel="prefetch" href="/assets/js/282.08824d97.js"><link rel="prefetch" href="/assets/js/283.b8b2be2c.js"><link rel="prefetch" href="/assets/js/284.226098a4.js"><link rel="prefetch" href="/assets/js/285.f9127a1f.js"><link rel="prefetch" href="/assets/js/286.5b5dba63.js"><link rel="prefetch" href="/assets/js/287.5087c412.js"><link rel="prefetch" href="/assets/js/288.d34c811a.js"><link rel="prefetch" href="/assets/js/289.4f9c2a2f.js"><link rel="prefetch" href="/assets/js/29.0edbaf3c.js"><link rel="prefetch" href="/assets/js/290.070fe09d.js"><link rel="prefetch" href="/assets/js/291.cba40277.js"><link rel="prefetch" href="/assets/js/292.6fa773b4.js"><link rel="prefetch" href="/assets/js/293.d545c5db.js"><link rel="prefetch" href="/assets/js/294.e4f38526.js"><link rel="prefetch" href="/assets/js/295.2d2f78e8.js"><link rel="prefetch" href="/assets/js/296.93f447d8.js"><link rel="prefetch" href="/assets/js/297.c9b1cfcd.js"><link rel="prefetch" href="/assets/js/298.01d362c5.js"><link rel="prefetch" href="/assets/js/299.6d3b75a2.js"><link rel="prefetch" href="/assets/js/30.ca261390.js"><link rel="prefetch" href="/assets/js/300.f347fff1.js"><link rel="prefetch" href="/assets/js/301.1e0c6b2e.js"><link rel="prefetch" href="/assets/js/302.319f8162.js"><link rel="prefetch" href="/assets/js/303.8b26b89c.js"><link rel="prefetch" href="/assets/js/304.dbed5a40.js"><link rel="prefetch" href="/assets/js/305.2733eaca.js"><link rel="prefetch" href="/assets/js/306.3916f33e.js"><link rel="prefetch" href="/assets/js/307.15f58323.js"><link rel="prefetch" href="/assets/js/308.eaacb242.js"><link rel="prefetch" href="/assets/js/309.08d2792e.js"><link rel="prefetch" href="/assets/js/31.a2284c18.js"><link rel="prefetch" href="/assets/js/310.bbc283bb.js"><link rel="prefetch" href="/assets/js/311.1f567d3c.js"><link rel="prefetch" href="/assets/js/312.bf710bc3.js"><link rel="prefetch" href="/assets/js/313.c0203209.js"><link rel="prefetch" href="/assets/js/314.047ce88e.js"><link rel="prefetch" href="/assets/js/315.d7066639.js"><link rel="prefetch" href="/assets/js/316.87619bde.js"><link rel="prefetch" href="/assets/js/317.3c0a798d.js"><link rel="prefetch" href="/assets/js/318.f604fb09.js"><link rel="prefetch" href="/assets/js/319.69bac471.js"><link rel="prefetch" href="/assets/js/32.7829b9ce.js"><link rel="prefetch" href="/assets/js/320.ceb180fb.js"><link rel="prefetch" href="/assets/js/33.d66e75c9.js"><link rel="prefetch" href="/assets/js/34.d61a4af7.js"><link rel="prefetch" href="/assets/js/35.9a32a392.js"><link rel="prefetch" href="/assets/js/36.6f3e11af.js"><link rel="prefetch" href="/assets/js/37.8638f588.js"><link rel="prefetch" href="/assets/js/38.b6e26127.js"><link rel="prefetch" href="/assets/js/39.401c7b5b.js"><link rel="prefetch" href="/assets/js/4.3279af2e.js"><link rel="prefetch" href="/assets/js/40.13a73e80.js"><link rel="prefetch" href="/assets/js/41.3061c78c.js"><link rel="prefetch" href="/assets/js/42.0666f348.js"><link rel="prefetch" href="/assets/js/43.ae18d599.js"><link rel="prefetch" href="/assets/js/44.25223a14.js"><link rel="prefetch" href="/assets/js/45.2972db2c.js"><link rel="prefetch" href="/assets/js/46.6158456e.js"><link rel="prefetch" href="/assets/js/47.864ce1d2.js"><link rel="prefetch" href="/assets/js/48.82616bf4.js"><link rel="prefetch" href="/assets/js/49.f37443c4.js"><link rel="prefetch" href="/assets/js/5.9575717f.js"><link rel="prefetch" href="/assets/js/50.bf79aa2e.js"><link rel="prefetch" href="/assets/js/51.f99967a7.js"><link rel="prefetch" href="/assets/js/52.26b2b3c0.js"><link rel="prefetch" href="/assets/js/53.5db736f0.js"><link rel="prefetch" href="/assets/js/54.a0acdf58.js"><link rel="prefetch" href="/assets/js/55.7c80be06.js"><link rel="prefetch" href="/assets/js/56.2f1da3a9.js"><link rel="prefetch" href="/assets/js/57.f1528bdc.js"><link rel="prefetch" href="/assets/js/58.1a948f7d.js"><link rel="prefetch" href="/assets/js/59.72454f7e.js"><link rel="prefetch" href="/assets/js/60.ece68aad.js"><link rel="prefetch" href="/assets/js/61.56043602.js"><link rel="prefetch" href="/assets/js/62.5aa5712e.js"><link rel="prefetch" href="/assets/js/63.d7fa9a29.js"><link rel="prefetch" href="/assets/js/64.9c8a6150.js"><link rel="prefetch" href="/assets/js/65.68396879.js"><link rel="prefetch" href="/assets/js/66.6a6276e5.js"><link rel="prefetch" href="/assets/js/67.f4bb8782.js"><link rel="prefetch" href="/assets/js/68.00af0150.js"><link rel="prefetch" href="/assets/js/69.00597c1e.js"><link rel="prefetch" href="/assets/js/7.ee3a9d4d.js"><link rel="prefetch" href="/assets/js/70.ac3239af.js"><link rel="prefetch" href="/assets/js/71.56ae365d.js"><link rel="prefetch" href="/assets/js/72.1840ec43.js"><link rel="prefetch" href="/assets/js/73.5926abf8.js"><link rel="prefetch" href="/assets/js/74.7d7ce973.js"><link rel="prefetch" href="/assets/js/75.cf0ed9b5.js"><link rel="prefetch" href="/assets/js/76.7f07c62d.js"><link rel="prefetch" href="/assets/js/77.8a32f214.js"><link rel="prefetch" href="/assets/js/78.a1e88d51.js"><link rel="prefetch" href="/assets/js/79.4332f5a6.js"><link rel="prefetch" href="/assets/js/8.cda5ef58.js"><link rel="prefetch" href="/assets/js/80.fd129254.js"><link rel="prefetch" href="/assets/js/81.cd7bfbef.js"><link rel="prefetch" href="/assets/js/82.ab43b205.js"><link rel="prefetch" href="/assets/js/83.66551360.js"><link rel="prefetch" href="/assets/js/84.acfd6a2d.js"><link rel="prefetch" href="/assets/js/85.5cc4a00f.js"><link rel="prefetch" href="/assets/js/86.2c560064.js"><link rel="prefetch" href="/assets/js/87.72edc221.js"><link rel="prefetch" href="/assets/js/88.70d0bb63.js"><link rel="prefetch" href="/assets/js/89.b286da96.js"><link rel="prefetch" href="/assets/js/9.49462c02.js"><link rel="prefetch" href="/assets/js/90.5cb3117c.js"><link rel="prefetch" href="/assets/js/91.b06d95e0.js"><link rel="prefetch" href="/assets/js/92.ede84d53.js"><link rel="prefetch" href="/assets/js/93.a9eebb7e.js"><link rel="prefetch" href="/assets/js/94.5964bcb1.js"><link rel="prefetch" href="/assets/js/95.b7068d5f.js"><link rel="prefetch" href="/assets/js/96.e7656ec2.js"><link rel="prefetch" href="/assets/js/97.05826775.js"><link rel="prefetch" href="/assets/js/98.51f3bf94.js"><link rel="prefetch" href="/assets/js/99.38a67400.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a8b5fd7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Chiriri's blog" class="logo"> <span class="site-name can-hide">Chiriri's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/844323/" class="nav-link">JavaSE</a></li><li class="dropdown-subitem"><a href="/pages/c10aa0/" class="nav-link">JavaEE</a></li><li class="dropdown-subitem"><a href="/pages/181a4e/" class="nav-link">设计模式</a></li></ul></li><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28b8ed/" class="nav-link">Python</a></li><li class="dropdown-subitem"><a href="/pages/e8a1e9/" class="nav-link">Python模块</a></li><li class="dropdown-subitem"><a href="/pages/1bc408/" class="nav-link">机器学习</a></li></ul></li><li class="dropdown-item"><h4>服务器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0a1800/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/a45110/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/pages/2b3ac4/" class="nav-link">NoSQL</a></li></ul></li><li class="dropdown-item"><h4>项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c2bda/" class="nav-link">传智健康</a></li><li class="dropdown-subitem"><a href="/pages/c57520/" class="nav-link">畅购商城</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/Hadoop/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Hadoop生态</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/27eb49/" class="nav-link">Hadoop</a></li><li class="dropdown-subitem"><a href="/pages/801487/" class="nav-link">Zookeeper</a></li><li class="dropdown-subitem"><a href="/pages/060f01/" class="nav-link">Hive</a></li><li class="dropdown-subitem"><a href="/pages/c13817/" class="nav-link">Flume</a></li><li class="dropdown-subitem"><a href="/pages/90b39f/" class="nav-link">Kafka</a></li><li class="dropdown-subitem"><a href="/pages/bac882/" class="nav-link">Azkaban</a></li><li class="dropdown-subitem"><a href="/pages/f4e35e/" class="nav-link">Hbase</a></li><li class="dropdown-subitem"><a href="/pages/a9a4c4/" class="nav-link">Scala</a></li><li class="dropdown-subitem"><a href="/pages/5a1e93/" class="nav-link">Spark</a></li></ul></li><li class="dropdown-item"><h4>大数据项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9ba1d7/" class="nav-link">离线数仓</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/Web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1e0197/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/7a583f/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/6af871/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/pages/79c836/" class="nav-link">Uni-APP</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/0cc32d/404" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="408" class="dropdown-title"><a href="/408/" class="link-title">408</a> <span class="title" style="display:none;">408</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ef1313/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/navigation/" class="nav-link">导航站</a></li></ul></div></div> <a href="https://github.com/Iekrwh/blog-VuePress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/$7ZY44WI036RW5{EPWQXCX6.jpg"> <div class="blogger-info"><h3>Iekr</h3> <span>苦逼后端开发</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/Java/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/844323/" class="nav-link">JavaSE</a></li><li class="dropdown-subitem"><a href="/pages/c10aa0/" class="nav-link">JavaEE</a></li><li class="dropdown-subitem"><a href="/pages/181a4e/" class="nav-link">设计模式</a></li></ul></li><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/28b8ed/" class="nav-link">Python</a></li><li class="dropdown-subitem"><a href="/pages/e8a1e9/" class="nav-link">Python模块</a></li><li class="dropdown-subitem"><a href="/pages/1bc408/" class="nav-link">机器学习</a></li></ul></li><li class="dropdown-item"><h4>服务器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0a1800/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/pages/a45110/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/pages/2b3ac4/" class="nav-link">NoSQL</a></li></ul></li><li class="dropdown-item"><h4>项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5c2bda/" class="nav-link">传智健康</a></li><li class="dropdown-subitem"><a href="/pages/c57520/" class="nav-link">畅购商城</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/Hadoop/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Hadoop生态</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/27eb49/" class="nav-link">Hadoop</a></li><li class="dropdown-subitem"><a href="/pages/801487/" class="nav-link">Zookeeper</a></li><li class="dropdown-subitem"><a href="/pages/060f01/" class="nav-link">Hive</a></li><li class="dropdown-subitem"><a href="/pages/c13817/" class="nav-link">Flume</a></li><li class="dropdown-subitem"><a href="/pages/90b39f/" class="nav-link">Kafka</a></li><li class="dropdown-subitem"><a href="/pages/bac882/" class="nav-link">Azkaban</a></li><li class="dropdown-subitem"><a href="/pages/f4e35e/" class="nav-link">Hbase</a></li><li class="dropdown-subitem"><a href="/pages/a9a4c4/" class="nav-link">Scala</a></li><li class="dropdown-subitem"><a href="/pages/5a1e93/" class="nav-link">Spark</a></li></ul></li><li class="dropdown-item"><h4>大数据项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9ba1d7/" class="nav-link">离线数仓</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/Web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1e0197/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/7a583f/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/6af871/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/pages/79c836/" class="nav-link">Uni-APP</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/0cc32d/404" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="408" class="dropdown-title"><a href="/408/" class="link-title">408</a> <span class="title" style="display:none;">408</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ef1313/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/navigation/" class="nav-link">导航站</a></li></ul></div></div> <a href="https://github.com/Iekrwh/blog-VuePress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Zookeeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hive</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flume</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azkaban</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hbase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Scala</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spark</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>离线数仓</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9ba1d7/" class="sidebar-link">数据仓库概念</a></li><li><a href="/pages/c501c6/" class="sidebar-link">项目需求及架构设计</a></li><li><a href="/pages/13deb1/" class="sidebar-link">数据生成模块</a></li><li><a href="/pages/0cc32d/" aria-current="page" class="active sidebar-link">数据采集模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#hadoop" class="sidebar-link">hadoop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#安装准备工作" class="sidebar-link">安装准备工作</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#安装java" class="sidebar-link">安装java</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#安装hadoop" class="sidebar-link">安装hadoop</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#xsync脚本" class="sidebar-link">xsync脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#ssh免密" class="sidebar-link">ssh免密</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#分发软件" class="sidebar-link">分发软件</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#集群配置" class="sidebar-link">集群配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#格式化" class="sidebar-link">格式化</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#hdfs存储多目录" class="sidebar-link">hdfs存储多目录</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#lzo压缩配置" class="sidebar-link">LZO压缩配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#编译" class="sidebar-link">编译</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#lzo创建索引" class="sidebar-link">LZO创建索引</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#基准测试" class="sidebar-link">基准测试</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#测试hdfs写性能" class="sidebar-link">测试HDFS写性能</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#测试hdfs读性能" class="sidebar-link">测试HDFS读性能</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#删除测试生成数据" class="sidebar-link">删除测试生成数据</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#使用sort测试mapreduce" class="sidebar-link">使用sort测试mapreduce</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#hadoop参数调优" class="sidebar-link">hadoop参数调优</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#zookeeper" class="sidebar-link">zookeeper</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#群起脚本" class="sidebar-link">群起脚本</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#日志生成" class="sidebar-link">日志生成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#代码参数说明" class="sidebar-link">代码参数说明</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#启动方式" class="sidebar-link">启动方式</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#日志收集" class="sidebar-link">日志收集</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#集群日志生成脚本" class="sidebar-link">集群日志生成脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#集群时间同步修改脚本-非正规临时脚本" class="sidebar-link">集群时间同步修改脚本（非正规临时脚本）</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#集群所有进程查看脚本" class="sidebar-link">集群所有进程查看脚本</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#采集日志flume" class="sidebar-link">采集日志Flume</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flume组件选择" class="sidebar-link">Flume组件选择</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flume配置" class="sidebar-link">Flume配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#etl和分类型拦截器" class="sidebar-link">ETL和分类型拦截器</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flume启动脚本" class="sidebar-link">flume启动脚本</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#kafka" class="sidebar-link">Kafka</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#群起脚本-2" class="sidebar-link">群起脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#创建kafka-topic" class="sidebar-link">创建Kafka Topic</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#压力测试" class="sidebar-link">压力测试</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#生产者" class="sidebar-link">生产者</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#消费者" class="sidebar-link">消费者</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#kafka机器数量计算" class="sidebar-link">kafka机器数量计算</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#消费kafka数据flume" class="sidebar-link">消费kafka数据flume</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#日志消费flume配置" class="sidebar-link">日志消费flume配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flume组件选择-2" class="sidebar-link">Flume组件选择</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#日志消费flume启动脚本" class="sidebar-link">日志消费Flume启动脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flume内存优化" class="sidebar-link">Flume内存优化</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#采集通道启动-停止脚本" class="sidebar-link">采集通道启动/停止脚本</a></li><li class="sidebar-sub-header level2"><a href="/pages/0cc32d/#采集模块总结" class="sidebar-link">采集模块总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#linux-shell相关总结" class="sidebar-link">Linux&amp;Shell相关总结</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#hadoop相关总结" class="sidebar-link">Hadoop相关总结</a></li><li class="sidebar-sub-header level3"><a href="/pages/0cc32d/#flme相关总结" class="sidebar-link">Flme相关总结</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#组成" class="sidebar-link">组成</a></li><li class="sidebar-sub-header level5"><a href="/pages/0cc32d/#taildir-source" class="sidebar-link">taildir source</a></li><li class="sidebar-sub-header level5"><a href="/pages/0cc32d/#channel" class="sidebar-link">channel</a></li><li class="sidebar-sub-header level5"><a href="/pages/0cc32d/#hdfs-sink" class="sidebar-link">HDFS sink</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#拦截器" class="sidebar-link">拦截器</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#选择器" class="sidebar-link">选择器</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#监控器" class="sidebar-link">监控器</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#flume-内存" class="sidebar-link">Flume 内存</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header level4"><a href="/pages/0cc32d/#flume采集数据会丢失吗" class="sidebar-link">Flume采集数据会丢失吗?</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%A4%A7%E6%95%B0%E6%8D%AE" title="分类" data-v-06225672>大数据</a></li><li data-v-06225672><a href="/categories/?category=%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93" title="分类" data-v-06225672>离线数仓</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Iekrwh" target="_blank" title="作者" class="beLink" data-v-06225672>Iekr</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">数据采集模块<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="数据采集模块"><a href="#数据采集模块" class="header-anchor">#</a> 数据采集模块</h1> <h2 id="hadoop"><a href="#hadoop" class="header-anchor">#</a> hadoop</h2> <h3 id="安装准备工作"><a href="#安装准备工作" class="header-anchor">#</a> 安装准备工作</h3> <p>安装工具包</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y epel-release  <span class="token comment">#额外软件源</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> -y psmisc <span class="token function">nc</span> net-tools <span class="token function">rsync</span> <span class="token function">vim</span> lrzsz ntp libzstd openssl-static tree iotop <span class="token function">git</span> <span class="token function">wget</span> <span class="token comment">#安装 psmisc工具包  nc工具包 net-tools工具包 rsync 远程同步  vim编辑器 lrzsz上传下载  ntp时间同步 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改静态ip</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">&quot;ens33&quot;</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.42.102
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token number">24</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.42.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.42.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">service</span> network restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改主机名</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/hostname
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改host</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">192.168</span>.42.102 hadoop102
<span class="token number">192.168</span>.42.103 hadoop103
<span class="token number">192.168</span>.42.104 hadoop104
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>windows上也配置host</p> <p>关闭防火墙</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> systemctl stop firewalld
<span class="token function">sudo</span> systemctl disable firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>创建用户 新版本hadoop无法使用root用户启动</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">useradd</span> atguigu
<span class="token function">sudo</span> <span class="token function">passwd</span> atguigu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改atguigu权限</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>visudo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">## Allow root to run any commands anywhere</span>
root    <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>     ALL
atguigu   <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>     ALL <span class="token comment">#在root下添加此行内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建opt下的存放目录</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt
<span class="token function">sudo</span> <span class="token function">mkdir</span> module
<span class="token function">sudo</span> <span class="token function">mkdir</span> software
<span class="token function">sudo</span> <span class="token function">chown</span> atguigu:atguigu /opt/module /opt/software
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="安装java"><a href="#安装java" class="header-anchor">#</a> 安装java</h3> <p>先卸载</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">rpm</span> -qa <span class="token operator">|</span> <span class="token function">grep</span> -i java <span class="token operator">|</span> <span class="token function">xargs</span> -n1 <span class="token function">sudo</span> <span class="token function">rpm</span> -e --nodeps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解压</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/software/
<span class="token function">tar</span> -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置环境变量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile.d/my_env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#JAVA_HOME</span>
<span class="token comment">#yum 为/usr/lib/jvm/java</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_212 
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>更新环境变量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">source</span> /etc/profile
java -version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="安装hadoop"><a href="#安装hadoop" class="header-anchor">#</a> 安装hadoop</h3> <p>解压</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> -zxvf hadoop-3.1.3.tar.gz -C /opt/module/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置环境变量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile.d/my_env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">##HADOOP_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/module/hadoop-3.1.3
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/sbin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>更新</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">source</span> /etc/profile
hadoop version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="xsync脚本"><a href="#xsync脚本" class="header-anchor">#</a> xsync脚本</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /home/atguigu
<span class="token function">vim</span> xsync
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#1. 判断参数个数</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> Not Enough Arguement<span class="token operator">!</span>
  <span class="token builtin class-name">exit</span><span class="token punctuation">;</span>
<span class="token keyword">fi</span>
<span class="token comment">#2. 遍历集群所有机器</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>  <span class="token variable">$host</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  <span class="token comment">#3. 遍历所有目录，挨个发送</span>
  <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">$@</span>
  <span class="token keyword">do</span>
    <span class="token comment">#4 判断文件是否存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> -e <span class="token variable">$file</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
      <span class="token comment">#5. 获取父目录</span>
      <span class="token assign-left variable">pdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> -P <span class="token punctuation">$(</span>dirname $file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
      <span class="token comment">#6. 获取当前文件的名称</span>
      <span class="token assign-left variable">fname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $file<span class="token variable">)</span></span>
      <span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;mkdir -p <span class="token variable">$pdir</span>&quot;</span>
      <span class="token function">rsync</span> -av <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$pdir</span>
    <span class="token keyword">else</span>
      <span class="token builtin class-name">echo</span> <span class="token variable">$file</span> does not exists<span class="token operator">!</span>
    <span class="token keyword">fi</span>
  <span class="token keyword">done</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> +x xsync
<span class="token function">sudo</span> <span class="token function">mv</span> xsync /bin/   <span class="token comment">#将脚本移动到/bin中，以便全局调用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="ssh免密"><a href="#ssh免密" class="header-anchor">#</a> ssh免密</h3> <p>生成ssh密钥</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>ssh-keygen -t rsa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>分发ssh密钥</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>ssh-copy-id hadoop102

ssh-copy-id hadoop103

ssh-copy-id hadoop104
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>以上生成和分发 需要在每台机器上执行</strong></p> <h3 id="分发软件"><a href="#分发软件" class="header-anchor">#</a> 分发软件</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/module/
xsync jdk1.8.0_212/
xsync hadoop-3.1.3/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>分发环境变量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">scp</span> /etc/profile.d/my_env.sh  root@hadoop103:/etc/profile.d/my_env.sh
<span class="token function">sudo</span> <span class="token function">scp</span> /etc/profile.d/my_env.sh  root@hadoop104:/etc/profile.d/my_env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="集群配置"><a href="#集群配置" class="header-anchor">#</a> 集群配置</h3> <p>集群规划</p> <table><thead><tr><th></th> <th>服务器hadoop102</th> <th>服务器hadoop103</th> <th>服务器hadoop104</th></tr></thead> <tbody><tr><td>HDFS</td> <td>NameNode  DataNode</td> <td>DataNode</td> <td>DataNode  SecondaryNameNode</td></tr> <tr><td>Yarn</td> <td>NodeManager</td> <td>Resourcemanager  NodeManager</td> <td>NodeManager</td></tr></tbody></table> <p>进配置文件夹</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/module/hadoop-3.1.3/etc/hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>core-site.xml</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> core-site.xml 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置hdfs默认的地址 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://hadoop102:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 配置hadoop临时存放路径--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/opt/module/hadoop-3.1.3/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 兼容性配置hive --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.proxyuser.atguigu.hosts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.proxyuser.atguigu.groups<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.http.staticuser.user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>atguigu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>hdfs-site.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 2nn的地址 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.secondary.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop104:9868<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>yarn-site.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--设置NodeManager上运行的附属服务，需配置成mapreduce_shuffle才可运行MapReduce程序--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.hostname<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.env-whitelist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--设定单个容器可以申领到的最小内存资源--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.scheduler.minimum-allocation-mb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2048<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.scheduler.maximum-allocation-mb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>4096<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--设定物理节点有4G内存加入资源池--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.resource.memory-mb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>4096<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.pmem-check-enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.vmem-check-enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>mapred-site.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--Hadoop对MapReduce运行框架一共提供了3种实现，在mapred-site.xml中通过&quot;mapreduce.framework.name&quot;这个属性来设置为&quot;classic&quot;、&quot;yarn&quot;或者&quot;local&quot;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>workers</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/hadoop-3.1.3/etc/hadoop/workers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除localhost  文件中添加的内容结尾不允许有空格，文件中不允许有空行。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop102
hadoop103
hadoop104
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>同步</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/hadoop-3.1.3/etc/hadoop/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="格式化"><a href="#格式化" class="header-anchor">#</a> 格式化</h3> <p>格式化hdfs</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hdfs namenode -format
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动dfs</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>start-dfs.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果报java未找到 修改hadoop.env.sh文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/hadoop-3.1.3/etc/hadoop/hadoop-env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改JAVA_HOME为 并同步</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_212
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动yarn</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>start-yarn.sh <span class="token comment">#在103机器上启动</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="hdfs存储多目录"><a href="#hdfs存储多目录" class="header-anchor">#</a> hdfs存储多目录</h3> <p>若HDFS存储空间紧张，需要对DataNode进行磁盘扩展。</p> <ol><li><p>在DataNode节点增加磁盘并进行挂载。</p> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211209154611618.png" alt="image-20211209154611618"></p></li> <li><p>在hdfs-site.xml文件中配置多目录，注意新挂载磁盘的访问权限问题。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.datanode.data.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>file:///${hadoop.tmp.dir}/dfs/data1,file:///hd2/dfs/data2,file:///hd3/dfs/data3,file:///hd4/dfs/data4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>增加磁盘后，保证每个目录数据均衡</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>bin/start-balancer.sh –threshold <span class="token number">10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对于参数10，代表的是集群中各个节点的磁盘空间利用率相差不超过10%，可根据实际情况进行调整。</p> <p>停止数据均衡命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>bin/stop-balancer.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h3 id="lzo压缩配置"><a href="#lzo压缩配置" class="header-anchor">#</a> LZO压缩配置</h3> <h4 id="编译"><a href="#编译" class="header-anchor">#</a> 编译</h4> <p>hadoop本身并不支持lzo压缩，故需要使用twitter提供的hadoop-lzo开源组件。hadoop-lzo需依赖hadoop和lzo进行编译，编译步骤如下</p> <p>下载、安装并编译LZO</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">sudo</span> yum -y <span class="token function">install</span> gcc-c++ lzo-devel zlib-devel autoconf automake libtool
<span class="token function">wget</span> http://www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz
<span class="token function">tar</span> -zxvf lzo-2.10.tar.gz
<span class="token builtin class-name">cd</span> lzo-2.10
./configure -prefix<span class="token operator">=</span>/usr/local/hadoop/lzo/
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>编译hadoop-lzo源码</p> <p>下载hadoop-lzo的源码，下载地址：https://github.com/twitter/hadoop-lzo/archive/master.zip</p> <p>解压之后，修改pom.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hadoop.current.version</span><span class="token punctuation">&gt;</span></span>2.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hadoop.current.version</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>声明两个临时环境变量</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">C_INCLUDE_PATH</span><span class="token operator">=</span>/usr/local/hadoop/lzo/include
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/hadoop/lzo/lib 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>编译打包</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mvn package -Dmaven.test.skip<span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入target，hadoop-lzo-0.4.21-SNAPSHOT.jar 即编译成功的hadoop-lzo组件</p> <h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <p>将编译好后的hadoop-lzo-0.4.20.jar 放入hadoop-3.1.3/share/hadoop/common/</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/software
<span class="token function">mv</span> hadoop-lzo-0.4.20.jar /opt/module/hadoop-3.1.3/share/hadoop/common/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>同步分发</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>core-site.xml增加配置支持LZO压缩</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加以下内容</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>io.compression.codecs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>
org.apache.hadoop.io.compress.GzipCodec,
org.apache.hadoop.io.compress.DefaultCodec,
org.apache.hadoop.io.compress.BZip2Codec,
org.apache.hadoop.io.compress.SnappyCodec,
com.hadoop.compression.lzo.LzoCodec,
com.hadoop.compression.lzo.LzopCodec
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>io.compression.codec.lzo.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.hadoop.compression.lzo.LzoCodec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>分发</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重新启动集群</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>stop-all.sh
start-dfs.sh <span class="token comment">#102</span>
start-yarn.sh  <span class="token comment">#103</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="lzo创建索引"><a href="#lzo创建索引" class="header-anchor">#</a> LZO创建索引</h3> <p>将bigtable.lzo（150M）上传到集群的/input目录</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop fs -mkdir /input
hadoop fs -put bigtable.lzo /input
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行wordcount程序</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>没有创建索引则LZO文件的切片只有一个</p> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211209163816027.png" alt="image-20211209163816027"></p> <p>创建索引</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># hadoop jar 编译好的lzo jar包  类引用路径  lzo数据文件</span>
hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer /input/bigtable.lzo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210182357330.png" alt="image-20211210182357330"></p> <p>重新执行wordcount</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210182447681.png" alt="image-20211210182447681"></p> <h3 id="基准测试"><a href="#基准测试" class="header-anchor">#</a> 基准测试</h3> <h4 id="测试hdfs写性能"><a href="#测试hdfs写性能" class="header-anchor">#</a> 测试HDFS写性能</h4> <p>向HDFS写10个128M的文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -write -nrFiles <span class="token number">10</span> -fileSize 128MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210184417692.png" alt="image-20211210184417692"></p> <h4 id="测试hdfs读性能"><a href="#测试hdfs读性能" class="header-anchor">#</a> 测试HDFS读性能</h4> <p>读取HDFS集群10个128M的文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -read -nrFiles <span class="token number">10</span> -fileSize 128MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210184740263.png" alt="image-20211210184740263"></p> <h4 id="删除测试生成数据"><a href="#删除测试生成数据" class="header-anchor">#</a> 删除测试生成数据</h4> <p>测试数据默认存储在 /benchmarks/TestDFSIO上</p> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210184829949.png" alt="image-20211210184829949"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar TestDFSIO -clean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="使用sort测试mapreduce"><a href="#使用sort测试mapreduce" class="header-anchor">#</a> 使用sort测试mapreduce</h4> <p>使用RandomWriter来产生随机数，每个节点运行10个Map任务，每个Map产生大约1G大小的二进制随机数</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar randomwriter random-data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行sort程序</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar <span class="token function">sort</span> random-data sorted-data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>验证数据是否真正排好序了</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>hadoop jar /opt/module/hadoop-3.1.3/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-3.1.3-tests.jar testmapredsort -sortInput random-data -sortOutput sorted-data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="hadoop参数调优"><a href="#hadoop参数调优" class="header-anchor">#</a> hadoop参数调优</h3> <ul><li><p>HDFS参数调优hdfs-site.xml</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">dfs.namenode.handler.count</span><span class="token punctuation">=</span><span class="token value attr-value">20 * log2(Cluster Size)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如集群规模为8台时，此参数设置为60</p> <p>NameNode有一个工作线程池，用来处理不同DataNode的并发心跳以及客户端并发的元数据操作。对于大集群或者有大量客户端的集群来说，通常需要增大参数dfs.namenode.handler.count的默认值10。设置该值的一般原则是将其设置为集群大小的自然对数乘以20，即20logN，N为集群大小</p></li> <li><p>YARN参数调优yarn-site.xml</p> <ul><li><p>情景描述：总共7台机器，每天几亿条数据，数据源-&gt;Flume-&gt;Kafka-&gt;HDFS-&gt;Hive</p></li> <li><p>面临问题：数据统计主要用HiveSQL，没有数据倾斜(每个reduce数据没有偏大或偏小)，小文件已经做了合并处理，开启的JVM重用，而且IO没有阻塞，内存用了不到50%。但是还是跑的非常慢，而且数据量洪峰过来时，整个集群都会宕掉。基于这种情况有没有优化方案。</p></li> <li><p>解决办法：内存利用率不够。这个一般是Yarn的2个配置造成的，单个任务可以申请的最大内存大小，和Hadoop单个节点可用内存大小。调节这两个参数能提高系统内存的利用率。</p> <ul><li><p>yarn.nodemanager.resource.memory-mb</p> <p>表示<strong>该节点上YARN可使用的物理内存总量</strong>，<strong>默认是8192（MB）</strong>，注意，如果你的节点内存资源不够8GB，则需要调减小这个值，而YARN不会智能的探测节点的物理内存总量。</p></li> <li><p>yarn.scheduler.maximum-allocation-mb</p> <p><strong>单个任务可申请的最多物理内存量</strong>，<strong>默认是8192（MB）</strong>。</p></li> <li><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211210192154377.png" alt="image-20211210192154377"></p></li></ul></li></ul></li> <li><p>Hadoop宕机</p> <ul><li>如果<strong>MR造成系统宕机</strong>。此时要控制Yarn同时运行的任务数，和每个任务申请的最大内存。调整参数：yarn.scheduler.maximum-allocation-mb（单个任务可申请的最多物理内存量，默认是8192MB）</li> <li>如果写入文件过量造成<strong>NameNode宕机</strong>。那么调高Kafka的存储大小，控制从Kafka到HDFS的写入速度。高峰期的时候用Kafka进行缓存，高峰期过去数据同步会自动跟上。</li></ul></li></ul> <h2 id="zookeeper"><a href="#zookeeper" class="header-anchor">#</a> zookeeper</h2> <p>集群规划</p> <table><thead><tr><th></th> <th>服务器hadoop102</th> <th>服务器hadoop103</th> <th>服务器hadoop104</th></tr></thead> <tbody><tr><td>Zookeeper</td> <td>Zookeeper</td> <td>Zookeeper</td> <td>Zookeeper</td></tr></tbody></table> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> -zxvf /opt/software/apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/
<span class="token function">mv</span> /opt/module/apache-zookeeper-3.5.7-bin/ /opt/module/zookeeper

<span class="token comment">#环境变量</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile.d/my_env.sh 
<span class="token comment">#追加</span>
<span class="token comment">#ZOOKEEPER_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/opt/module/zookeeper
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin


<span class="token comment">#同步环境变量</span>
<span class="token builtin class-name">source</span> /etc/profile.d/my_env.sh 
<span class="token function">sudo</span> xsync /etc/profile.d/my_env.sh 

<span class="token comment">#将配置文件改名称为zoo.cfg</span>
<span class="token builtin class-name">cd</span> /opt/module/zookeeper/conf/
<span class="token function">cp</span> zoo_sample.cfg zoo.cfg

<span class="token comment">#配置zookeeper文件</span>
<span class="token function">vim</span> zoo.cfg 
<span class="token comment">#追加下内容</span>
server.2<span class="token operator">=</span>hadoop102:2888:3888
server.3<span class="token operator">=</span>hadoop103:2888:3888
server.4<span class="token operator">=</span>hadoop104:2888:3888
<span class="token comment">#修改数据存储位置</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/opt/module/zookeeper/zkData

<span class="token builtin class-name">cd</span> /opt/module/zookeeper
<span class="token function">mkdir</span> zkData

<span class="token comment">#创建myid用于zookeeper标记机器</span>
<span class="token comment">#编辑为102的2用于唯一标识 103为3 104为4</span>
<span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">&gt;</span> /opt/module/zookeeper/zkData/myid

<span class="token comment">#同步</span>
xsync /opt/module/zookeeper/

<span class="token comment">#103</span>
<span class="token builtin class-name">echo</span> <span class="token number">3</span> <span class="token operator">&gt;</span> /opt/module/zookeeper/zkData/myid
<span class="token comment">#104</span>
<span class="token builtin class-name">echo</span> <span class="token number">4</span> <span class="token operator">&gt;</span> /opt/module/zookeeper/zkData/myid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>启动</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#在三台机器上分别启动</span>
zkServer.sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="群起脚本"><a href="#群起脚本" class="header-anchor">#</a> 群起脚本</h3> <p>在hadoop102的/home/atguigu/bin目录下创建脚本</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">mkdir</span> -p /home/atguigu/bin
<span class="token builtin class-name">cd</span> /home/atguigu/bin
<span class="token function">vim</span> zk.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------- <span class="token variable">$i</span> -------------&quot;</span>
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper/bin/zkServer.sh start&quot;</span>
    <span class="token keyword">done</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------- <span class="token variable">$i</span> -------------&quot;</span>
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper/bin/zkServer.sh stop&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;------------- <span class="token variable">$i</span> -------------&quot;</span>
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper/bin/zkServer.sh status&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>增加权限</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> zk.sh
zk.sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="日志生成"><a href="#日志生成" class="header-anchor">#</a> 日志生成</h2> <p>将之前日志生成的带依赖jar上传到102上</p> <h3 id="代码参数说明"><a href="#代码参数说明" class="header-anchor">#</a> 代码参数说明</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 参数一：控制发送每条的延时时间，默认是0</span>
<span class="token class-name">Long</span> delay <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0L</span><span class="token punctuation">;</span>

<span class="token comment">// 参数二：循环遍历次数</span>
<span class="token keyword">int</span> loop_len <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="启动方式"><a href="#启动方式" class="header-anchor">#</a> 启动方式</h3> <p>启动方式有两种:</p> <ol><li><p>通过jar -classpath指定全类名启动</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -classpath log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar com.atguigu.appclient.AppMain  <span class="token operator">&gt;</span>/opt/module/test.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>通过jar -jar 启动 必须打包时指定启动类类引用否则无法启动</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -jar log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar  <span class="token operator">&gt;</span>/opt/module/test.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h3 id="日志收集"><a href="#日志收集" class="header-anchor">#</a> 日志收集</h3> <p>我们通过上面方式启动 java程序会收集控制台中的输出 但我们已经通过logback收集日志到指定路径文件了 我们无需保存控制台上的输出内容 可以通过将输出内容直接输出到/dev/null中</p> <p>/dev/null代表linux的空设备文件，所有往这个文件里面写入的内容都会丢失，俗称“黑洞”。</p> <table><thead><tr><th>名称</th> <th>代码</th> <th>操作符</th> <th>Java中表示</th> <th>Linux 下文件描述符（Debian 为例)</th></tr></thead> <tbody><tr><td>标准输入(stdin)</td> <td>0</td> <td>&lt; 或 &lt;&lt;</td> <td><a href="http://system.in/" target="_blank" rel="noopener noreferrer">System.in<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>/dev/stdin -&gt; /proc/self/fd/0 -&gt; /dev/pts/0</td></tr> <tr><td>标准输出(stdout)</td> <td>1</td> <td>&gt;, &gt;&gt;, 1&gt; 或 1&gt;&gt;</td> <td>System.out</td> <td>/dev/stdout -&gt; /proc/self/fd/1 -&gt; /dev/pts/0</td></tr> <tr><td>标准错误输出(stderr)</td> <td>2</td> <td>2&gt; 或 2&gt;&gt;</td> <td>System.err</td> <td>/dev/stderr -&gt; /proc/self/fd/2 -&gt; /dev/pts/0</td></tr></tbody></table> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -jar log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以简写为</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>java -jar log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar  <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在/tmp/logs路径下查看生成的日志文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /tmp/logs/
<span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="集群日志生成脚本"><a href="#集群日志生成脚本" class="header-anchor">#</a> 集群日志生成脚本</h3> <p>先同步日志jar到集群其他机器上</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在/home/atguigu/bin目录下创建脚本lg.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /home/atguigu/bin/lg.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 
<span class="token keyword">do</span>
	<span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;java -jar /opt/module/log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar <span class="token variable">$1</span> <span class="token variable">$2</span> &gt;/dev/null 2&gt;&amp;1 &amp;&quot;</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> /home/atguigu/bin/lg.sh
/home/atguigu/bin/lg.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="集群时间同步修改脚本-非正规临时脚本"><a href="#集群时间同步修改脚本-非正规临时脚本" class="header-anchor">#</a> 集群时间同步修改脚本（非正规临时脚本）</h3> <p>在/home/atguigu/bin目录下创建脚本dt.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /home/atguigu/bin/dt.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;========== <span class="token variable">$i</span> ==========&quot;</span>
    <span class="token function">ssh</span> -t <span class="token variable">$i</span> <span class="token string">&quot;sudo date -s <span class="token variable">$1</span>&quot;</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ssh -t 通常用于ssh远程执行sudo命令</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> /home/atguigu/bin/dt.sh
/home/atguigu/bin/dt.sh <span class="token number">2020</span>-03-10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="集群所有进程查看脚本"><a href="#集群所有进程查看脚本" class="header-anchor">#</a> 集群所有进程查看脚本</h3> <p>在/home/atguigu/bin目录下创建脚本xcall.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /home/atguigu/bin/xcall.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> --------- <span class="token variable">$i</span> ----------
    <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;<span class="token variable">$*</span>&quot;</span>
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code> <span class="token function">chmod</span> <span class="token number">755</span> /home/atguigu/bin/xcall.sh
 xcall.sh jps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="采集日志flume"><a href="#采集日志flume" class="header-anchor">#</a> 采集日志Flume</h2> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211153656826.png" alt="image-20211211153656826"></p> <p>集群规划：</p> <table><thead><tr><th></th> <th>服务器hadoop102</th> <th>服务器hadoop103</th> <th>服务器hadoop104</th></tr></thead> <tbody><tr><td>Flume(采集日志)</td> <td>Flume</td> <td>Flume</td> <td></td></tr></tbody></table> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> -zxvf /opt/software/apache-flume-1.9.0-bin.tar.gz -C /opt/module/
<span class="token builtin class-name">cd</span> /opt/module/
<span class="token function">mv</span> /opt/module/apache-flume-1.9.0-bin /opt/module/flume
<span class="token comment">#将lib文件夹下的guava-11.0.2.jar删除以兼容Hadoop 3.1.3</span>
<span class="token function">rm</span> /opt/module/flume/lib/guava-11.0.2.jar
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile.d/my_env.sh 

<span class="token comment">#FLUME_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FLUME_HOME</span><span class="token operator">=</span>/opt/module/flume
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$FLUME_HOME</span>/bin

<span class="token builtin class-name">source</span> /etc/profile.d/my_env.sh 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>同步</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/module/
xsync flume/
<span class="token function">sudo</span> xsync /etc/profile.d/my_env.sh 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="flume组件选择"><a href="#flume组件选择" class="header-anchor">#</a> Flume组件选择</h3> <ol><li>Source</li></ol> <p>（1）Taildir Source相比Exec Source、Spooling Directory Source的优势</p> <p>TailDir Source：**断点续传、多目录。**Flume1.6以前需要自己自定义Source记录每次读取文件位置，实现断点续传。</p> <p>Exec Source可以实时搜集数据，但是在Flume不运行或者Shell命令出错的情况下，<strong>数据将会丢失</strong>。</p> <p>Spooling Directory Source监控目录，<strong>不支持断点续传</strong>。</p> <p>（2）batchSize大小如何设置？</p> <p>答：Event 1K左右时，500-1000合适（默认为100）</p> <ol start="2"><li>Channel</li></ol> <p><strong>采用Kafka Channel，省去了Sink</strong>，提高了效率。KafkaChannel数据存储在Kafka里面，所以数据是存储在磁盘中。</p> <p>注意在Flume1.7以前，Kafka Channel很少有人使用，因为发现<strong>parseAsFlumeEvent</strong>这个配置起不了作用。也就是无论parseAsFlumeEvent配置为true还是false，都会转为Flume Event。这样的话，造成的结果是，会始终都把Flume的headers中的信息混合着内容一起写入Kafka的消息中，这显然不是我所需要的，我只是需要把内容写入即可。</p> <h3 id="flume配置"><a href="#flume配置" class="header-anchor">#</a> Flume配置</h3> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211154528000.png" alt="image-20211211154528000"></p> <p>file-flume-kafka.conf文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /opt/module/flume/conf
<span class="token function">vim</span> file-flume-kafka.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">a1.sources</span><span class="token punctuation">=</span><span class="token value attr-value">r1</span>
<span class="token key attr-name">a1.channels</span><span class="token punctuation">=</span><span class="token value attr-value">c1 c2</span>

<span class="token comment"># configure source</span>
<span class="token key attr-name">a1.sources.r1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">TAILDIR</span>
<span class="token key attr-name">a1.sources.r1.positionFile</span> <span class="token punctuation">=</span> <span class="token value attr-value">/opt/module/flume/test/log_position.json</span>
<span class="token key attr-name">a1.sources.r1.filegroups</span> <span class="token punctuation">=</span> <span class="token value attr-value">f1</span>
<span class="token key attr-name">a1.sources.r1.filegroups.f1</span> <span class="token punctuation">=</span> <span class="token value attr-value">/tmp/logs/app.+</span>
<span class="token key attr-name">a1.sources.r1.fileHeader</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">a1.sources.r1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1 c2</span>

<span class="token comment">#interceptor</span>
<span class="token key attr-name">a1.sources.r1.interceptors</span> <span class="token punctuation">=</span>  <span class="token value attr-value">i1 i2</span>
<span class="token key attr-name">a1.sources.r1.interceptors.i1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.atguigu.flume.interceptor.LogETLInterceptor$Builder</span>
<span class="token key attr-name">a1.sources.r1.interceptors.i2.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">com.atguigu.flume.interceptor.LogTypeInterceptor$Builder</span>

<span class="token key attr-name">a1.sources.r1.selector.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">multiplexing</span>
<span class="token key attr-name">a1.sources.r1.selector.header</span> <span class="token punctuation">=</span> <span class="token value attr-value">topic</span>
<span class="token key attr-name">a1.sources.r1.selector.mapping.topic_start</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
<span class="token key attr-name">a1.sources.r1.selector.mapping.topic_event</span> <span class="token punctuation">=</span> <span class="token value attr-value">c2</span>

<span class="token comment"># configure channel</span>
<span class="token key attr-name">a1.channels.c1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.flume.channel.kafka.KafkaChannel</span>
<span class="token key attr-name">a1.channels.c1.kafka.bootstrap.servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">hadoop102:9092,hadoop103:9092,hadoop104:9092</span>
<span class="token key attr-name">a1.channels.c1.kafka.topic</span> <span class="token punctuation">=</span> <span class="token value attr-value">topic_start</span>
<span class="token key attr-name">a1.channels.c1.parseAsFlumeEvent</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">a1.channels.c1.kafka.consumer.group.id</span> <span class="token punctuation">=</span> <span class="token value attr-value">flume-consumer</span>

<span class="token key attr-name">a1.channels.c2.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.flume.channel.kafka.KafkaChannel</span>
<span class="token key attr-name">a1.channels.c2.kafka.bootstrap.servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">hadoop102:9092,hadoop103:9092,hadoop104:9092</span>
<span class="token key attr-name">a1.channels.c2.kafka.topic</span> <span class="token punctuation">=</span> <span class="token value attr-value">topic_event</span>
<span class="token key attr-name">a1.channels.c2.parseAsFlumeEvent</span> <span class="token punctuation">=</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">a1.channels.c2.kafka.consumer.group.id</span> <span class="token punctuation">=</span> <span class="token value attr-value">flume-consumer</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211160212975.png" alt="image-20211211160212975"></p> <h3 id="etl和分类型拦截器"><a href="#etl和分类型拦截器" class="header-anchor">#</a> ETL和分类型拦截器</h3> <p>本项目中自定义了两个拦截器，分别是：ETL拦截器、日志类型区分拦截器。</p> <p>ETL拦截器主要用于，过滤时间戳不合法和Json数据不完整的日志</p> <p>日志类型区分拦截器主要用于，将启动日志和事件日志区分开来，方便发往Kafka的不</p> <p>在ide创建flume-interceptor工程 导入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flume<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flume-ng-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>创建com.atguigu.flume.interceptor包  包下创建 LogETLInterceptor 类 并实现Interceptor接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">Interceptor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogETLInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Event</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//将event转换为string 方便处理</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//判断日志是启动日志还是事件日志 并向header中添加标识</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//清洗启动日志</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogUtils</span><span class="token punctuation">.</span><span class="token function">validateStart</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> event<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//清洗事件日志</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogUtils</span><span class="token punctuation">.</span><span class="token function">validateEvent</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> event<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> intercepts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Event</span> event <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Event</span> intercept <span class="token operator">=</span> <span class="token function">intercept</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>intercept <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                intercepts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>intercept<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> intercepts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor<span class="token punctuation">.</span>Builder</span><span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Interceptor</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogETLInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>LogUtils 工具类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">NumberUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogUtils</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">validateStart</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//开头不是以{或结尾不是以}结束的 不是json字符串</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> log<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">validateEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>log <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//以 | 切割</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> logConents <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\|&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断长度</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logConents<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断服务器时间是否够13位 并且判断是否全为数字</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logConents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">13</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token function">isDigits</span><span class="token punctuation">(</span>logConents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//判断json完整性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>logConents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>logConents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>分类型拦截器 LogTypeInterceptor</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">Interceptor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogTypeInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Event</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//取出body数据</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//header</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;topic_start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;topic_event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> event<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> resultEvent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Event</span> event <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            resultEvent<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> resultEvent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor<span class="token punctuation">.</span>Builder</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Interceptor</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogTypeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p><strong>打包上传jar包到flume的lib中 选择不带依赖即可</strong></p> <p>同步分发</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/flume/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="flume启动脚本"><a href="#flume启动脚本" class="header-anchor">#</a> flume启动脚本</h3> <p>在/home/atguigu/bin目录下创建脚本f1.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /home/atguigu/bin/f1.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103
        <span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------启动 <span class="token variable">$i</span> 采集flume-------&quot;</span>
                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;nohup /opt/module/flume/bin/flume-ng agent --conf-file /opt/module/flume/conf/file-flume-kafka.conf --name a1 -Dflume.root.logger=INFO,LOGFILE &gt;/opt/module/flume/test1 2&gt;&amp;1  &amp;&quot;</span>
        <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>	
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103
        <span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------停止 <span class="token variable">$i</span> 采集flume-------&quot;</span>
                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;ps -ef | grep file-flume-kafka | grep -v grep |awk  '{print \<span class="token variable">$2</span>}' | xargs -n1 kill -9 &quot;</span>
        <span class="token keyword">done</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>说明1：nohup，该命令可以在你退出帐户/关闭终端之后继续运行相应的进程。nohup就是不挂起的意思，不挂断地运行命令。</p> <p>说明2：awk 默认分隔符为空格</p> <p>说明3：xargs 表示取出前面命令运行的结果，作为后面命令的输入参数。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /home/atguigu/bin/
<span class="token function">chmod</span> <span class="token number">755</span> f1.sh
f1.sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="kafka"><a href="#kafka" class="header-anchor">#</a> Kafka</h2> <p>集群规划：</p> <table><thead><tr><th></th> <th>服务器hadoop102</th> <th>服务器hadoop103</th> <th>服务器hadoop104</th></tr></thead> <tbody><tr><td>Kafka</td> <td>Kafka</td> <td>Kafka</td> <td>Kafka</td></tr></tbody></table> <p>要先启动zookeeper</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">tar</span> -zxvf /opt/software/kafka_2.11-2.4.1.tgz -C /opt/module/
<span class="token builtin class-name">cd</span> /opt/module/
<span class="token function">mv</span> kafka_2.11-2.4.1/ kafka
<span class="token builtin class-name">cd</span> kafka
<span class="token function">mkdir</span> logs

<span class="token comment">#环境变量</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile.d/my_env.sh

<span class="token comment">#KAFKA_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HOME</span><span class="token operator">=</span>/opt/module/kafka
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$KAFKA_HOME</span>/bin

<span class="token builtin class-name">source</span> /etc/profile.d/my_env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>配置kafka</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/kafka/config/server.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>除了删除功能是新添加属性 其他都是修改</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#broker的全局唯一编号，不能重复</span>
<span class="token key attr-name">broker.id</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>

<span class="token comment">#添加删除功能</span>
<span class="token comment">#删除topic功能使能</span>
<span class="token key attr-name">delete.topic.enable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

<span class="token comment">#kafka运行日志存放的路径</span>
<span class="token key attr-name">log.dirs</span><span class="token punctuation">=</span><span class="token value attr-value">/opt/module/kafka/logs</span>

<span class="token comment">#配置连接Zookeeper集群地址</span>
<span class="token key attr-name">zookeeper.connect</span><span class="token punctuation">=</span><span class="token value attr-value">hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>同步</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync /opt/module/kafka 
<span class="token function">sudo</span> xsync /etc/profile.d/my_env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改每个kafka中 broker.id</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/kafka/config/server.properties
<span class="token comment">#102 为 0, 103为1  , 104为2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="群起脚本-2"><a href="#群起脚本-2" class="header-anchor">#</a> 群起脚本</h3> <p>在/home/atguigu/bin目录下创建脚本kf.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /home/atguigu/bin/kf.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------启动 <span class="token variable">$i</span> Kafka-------&quot;</span>
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------停止 <span class="token variable">$i</span> Kafka-------&quot;</span>
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/kafka/bin/kafka-server-stop.sh&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /home/atguigu/bin/
<span class="token function">chmod</span> <span class="token number">755</span> kf.sh
kf.sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="创建kafka-topic"><a href="#创建kafka-topic" class="header-anchor">#</a> 创建Kafka Topic</h3> <p>进入到/opt/module/kafka/目录下分别创建：启动日志主题、事件日志主题</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-topics.sh --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka  --create --replication-factor <span class="token number">1</span> --partitions <span class="token number">1</span> --topic topic_start
kafka-topics.sh --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka   --create --replication-factor <span class="token number">1</span> --partitions <span class="token number">1</span> --topic topic_event
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查询topic列表</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-topics.sh --zookeeper hadoop102:2181/kafka --list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除topic</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-topics.sh --delete --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka --topic topic_start
kafka-topics.sh --delete --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka --topic topic_event
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>生产消息</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-console-producer.sh --broker-list hadoop102:9092 --topic topic_start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>消费消息</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --from-beginning --topic topic_start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="压力测试"><a href="#压力测试" class="header-anchor">#</a> 压力测试</h3> <p>用Kafka官方自带的脚本，对Kafka进行压测。Kafka压测时，可以查看到哪个地方出现了瓶颈（CPU，内存，网络IO）。一般都是网络IO达到瓶颈。</p> <h4 id="生产者"><a href="#生产者" class="header-anchor">#</a> 生产者</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-producer-perf-test.sh  --topic <span class="token builtin class-name">test</span> --record-size <span class="token number">100</span> --num-records <span class="token number">100000</span> --throughput -1 --producer-props bootstrap.servers<span class="token operator">=</span>hadoop102:9092,hadoop103:9092,hadoop104:9092
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>record-size是一条信息有多大，单位是字节。</p> <p>num-records是总共发送多少条信息。</p> <p>throughput 是每秒多少条信息，设成-1，表示不限流，可测出生产者最大吞吐量。</p> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211214537511.png" alt="image-20211211214537511"></p> <p>本例中一共写入10w条消息，吞吐量为<strong>7.05 MB/sec</strong>，每次写入的平均延迟为408.12毫秒，最大的延迟为603.00毫秒。</p> <h4 id="消费者"><a href="#消费者" class="header-anchor">#</a> 消费者</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>kafka-consumer-perf-test.sh --broker-list hadoop102:9092,hadoop103:9092,hadoop104:9092 --topic <span class="token builtin class-name">test</span> --fetch-size <span class="token number">10000</span> --messages <span class="token number">10000000</span> --threads <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>--zookeeper 指定zookeeper的链接信息</p> <p>--topic 指定topic的名称</p> <p>--fetch-size 指定每次fetch的数据的大小</p> <p>--messages 总共要消费的消息个数</p> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211214836809.png" alt="image-20211211214836809"></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>start.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>开始测试时间，测试结束数据，共消费数据</strong>9.5367MB，吞吐量<strong>0.7875MB/s****，共消费</strong>100000条，平均每秒消费**8257条。</p> <h3 id="kafka机器数量计算"><a href="#kafka机器数量计算" class="header-anchor">#</a> kafka机器数量计算</h3> <p><em><em>Kafka机器数量（经验公式）=2</em>（峰值生产速度*副本数/100）+1</em>*</p> <p>先拿到峰值生产速度，再根据设定的副本数，就能预估出需要部署Kafka的数量。</p> <p>比如我们的峰值生产速度是50M/s。副本数为2。</p> <p>Kafka机器数量=2*（50*2/100）+ 1=3台</p> <h2 id="消费kafka数据flume"><a href="#消费kafka数据flume" class="header-anchor">#</a> 消费kafka数据flume</h2> <p><strong>此flume用于消费kafka中的数据 上传至hdfs上</strong></p> <p>集群规划</p> <table><thead><tr><th></th> <th>服务器hadoop102</th> <th>服务器hadoop103</th> <th>服务器hadoop104</th></tr></thead> <tbody><tr><td>Flume（消费Kafka）</td> <td></td> <td></td> <td>Flume</td></tr></tbody></table> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211211235139863.png" alt="image-20211211235139863"></p> <h3 id="日志消费flume配置"><a href="#日志消费flume配置" class="header-anchor">#</a> 日志消费flume配置</h3> <p>目前是启动日志和事件日志写在同一个config配置中 <strong>建议拆分为两个配置文件分开运行 解耦</strong></p> <p>在<strong>hadoop104</strong>的/opt/module/flume/conf目录下创建kafka-flume-hdfs.conf文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/flume/conf/kafka-flume-hdfs.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">## 组件</span>
<span class="token key attr-name">a1.sources</span><span class="token punctuation">=</span><span class="token value attr-value">r1 r2</span>
<span class="token key attr-name">a1.channels</span><span class="token punctuation">=</span><span class="token value attr-value">c1 c2</span>
<span class="token key attr-name">a1.sinks</span><span class="token punctuation">=</span><span class="token value attr-value">k1 k2</span>

<span class="token comment">## source1</span>
<span class="token key attr-name">a1.sources.r1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.flume.source.kafka.KafkaSource</span>
<span class="token comment">#控制消费速度 每秒5000条</span>
<span class="token key attr-name">a1.sources.r1.batchSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000</span>
<span class="token comment">#延迟时间如果指定毫秒数没有到达指定消费速度 同样消费速度</span>
<span class="token key attr-name">a1.sources.r1.batchDurationMillis</span> <span class="token punctuation">=</span> <span class="token value attr-value">2000</span>
<span class="token key attr-name">a1.sources.r1.kafka.bootstrap.servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">hadoop102:9092,hadoop103:9092,hadoop104:9092</span>
<span class="token key attr-name">a1.sources.r1.kafka.topics</span><span class="token punctuation">=</span><span class="token value attr-value">topic_start</span>

<span class="token comment">## source2</span>
<span class="token key attr-name">a1.sources.r2.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.flume.source.kafka.KafkaSource</span>
<span class="token key attr-name">a1.sources.r2.batchSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">5000</span>
<span class="token key attr-name">a1.sources.r2.batchDurationMillis</span> <span class="token punctuation">=</span> <span class="token value attr-value">2000</span>
<span class="token key attr-name">a1.sources.r2.kafka.bootstrap.servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">hadoop102:9092,hadoop103:9092,hadoop104:9092</span>
<span class="token key attr-name">a1.sources.r2.kafka.topics</span><span class="token punctuation">=</span><span class="token value attr-value">topic_event</span>

<span class="token comment">## channel1</span>
<span class="token key attr-name">a1.channels.c1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">file</span>
<span class="token key attr-name">a1.channels.c1.checkpointDir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/opt/module/flume/checkpoint/behavior1</span>
<span class="token key attr-name">a1.channels.c1.dataDirs</span> <span class="token punctuation">=</span> <span class="token value attr-value">/opt/module/flume/data/behavior1/</span>
<span class="token key attr-name">a1.channels.c1.maxFileSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">2146435071</span>
<span class="token key attr-name">a1.channels.c1.capacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000000</span>
<span class="token key attr-name">a1.channels.c1.keep-alive</span> <span class="token punctuation">=</span> <span class="token value attr-value">6</span>

<span class="token comment">## channel2</span>
<span class="token key attr-name">a1.channels.c2.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">file</span>
<span class="token comment">#checkpointDir为存储日志 dataDirs为存储数据位置 两目录可以指定一个多目录路径提高读写性能</span>
<span class="token key attr-name">a1.channels.c2.checkpointDir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/opt/module/flume/checkpoint/behavior2</span>
<span class="token key attr-name">a1.channels.c2.dataDirs</span> <span class="token punctuation">=</span> <span class="token value attr-value">/opt/module/flume/data/behavior2/</span>
<span class="token comment">#文件最大值</span>
<span class="token key attr-name">a1.channels.c2.maxFileSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">2146435071</span>
<span class="token comment">#数据容量</span>
<span class="token key attr-name">a1.channels.c2.capacity</span> <span class="token punctuation">=</span> <span class="token value attr-value">1000000</span>
<span class="token comment">#等待时长 如果容量未达到指定大小,并且超过指定时间则提交到sink</span>
<span class="token key attr-name">a1.channels.c2.keep-alive</span> <span class="token punctuation">=</span> <span class="token value attr-value">6</span>

<span class="token comment">## sink1</span>
<span class="token key attr-name">a1.sinks.k1.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">hdfs</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.path</span> <span class="token punctuation">=</span> <span class="token value attr-value">/origin_data/gmall/log/topic_start/%Y-%m-%d</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.filePrefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">logstart-</span>

<span class="token comment">##sink2</span>
<span class="token key attr-name">a1.sinks.k2.type</span> <span class="token punctuation">=</span> <span class="token value attr-value">hdfs</span>
<span class="token key attr-name">a1.sinks.k2.hdfs.path</span> <span class="token punctuation">=</span> <span class="token value attr-value">/origin_data/gmall/log/topic_event/%Y-%m-%d</span>
<span class="token key attr-name">a1.sinks.k2.hdfs.filePrefix</span> <span class="token punctuation">=</span> <span class="token value attr-value">logevent-</span>

<span class="token comment">## 不要产生大量小文件 以下3个配置属性满足任意一个则滚动到下一个文件</span>
<span class="token comment">#等待多少秒才滚动到下一个文件 默认为30s 建议为3600s</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.rollInterval</span> <span class="token punctuation">=</span> <span class="token value attr-value">10</span>
<span class="token comment">#多少字节滚动一次 默认为1024</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.rollSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">134217728</span>
<span class="token comment">#event写入的个数滚动 默认为10  0则为禁用</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.rollCount</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>

<span class="token key attr-name">a1.sinks.k2.hdfs.rollInterval</span> <span class="token punctuation">=</span> <span class="token value attr-value">10</span>
<span class="token key attr-name">a1.sinks.k2.hdfs.rollSize</span> <span class="token punctuation">=</span> <span class="token value attr-value">134217728</span>
<span class="token key attr-name">a1.sinks.k2.hdfs.rollCount</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>

<span class="token comment">## 控制输出文件是否原生文件 此处设置为压缩流</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.fileType</span> <span class="token punctuation">=</span> <span class="token value attr-value">CompressedStream </span>
<span class="token key attr-name">a1.sinks.k2.hdfs.fileType</span> <span class="token punctuation">=</span> <span class="token value attr-value">CompressedStream </span>

<span class="token comment"># 设置压缩格式</span>
<span class="token key attr-name">a1.sinks.k1.hdfs.codeC</span> <span class="token punctuation">=</span> <span class="token value attr-value">lzop</span>
<span class="token key attr-name">a1.sinks.k2.hdfs.codeC</span> <span class="token punctuation">=</span> <span class="token value attr-value">lzop</span>

<span class="token comment">## 拼装</span>
<span class="token key attr-name">a1.sources.r1.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c1</span>
<span class="token key attr-name">a1.sinks.k1.channel</span><span class="token punctuation">=</span> <span class="token value attr-value">c1</span>

<span class="token key attr-name">a1.sources.r2.channels</span> <span class="token punctuation">=</span> <span class="token value attr-value">c2</span>
<span class="token key attr-name">a1.sinks.k2.channel</span><span class="token punctuation">=</span> <span class="token value attr-value">c2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20211212002541874.png" alt="image-20211212002541874"></p> <h3 id="flume组件选择-2"><a href="#flume组件选择-2" class="header-anchor">#</a> Flume组件选择</h3> <ol><li><strong>FileChannel和MemoryChannel区别</strong></li></ol> <p>MemoryChannel传输数据速度更快，但因为数据保存在JVM的堆内存中，Agent进程挂掉会导致数据丢失，适用于对数据质量要求不高的需求。</p> <p>FileChannel传输速度相对于Memory慢，但数据安全保障高，Agent进程挂掉也可以从失败中恢复数据。</p> <p><strong>企业选型：</strong></p> <ul><li>金融类公司、对钱要求非常准确的公司通常会选择FileChannel</li> <li>传输的是普通日志信息（京东内部一天丢100万-200万条，这是非常正常的），通常选择MemoryChannel。</li></ul> <ol start="2"><li><p><strong>FileChannel优化</strong></p> <p><strong>通过配置dataDirs指向多个路径，每个路径对应不同的硬盘，增大Flume吞吐量。</strong></p> <p>官方说明如下：</p> <p>Comma separated list of directories for storing log files. Using multiple directories on separate disks can improve file channel peformance</p> <p>checkpointDir和backupCheckpointDir也尽量配置在不同硬盘对应的目录中，保证checkpoint坏掉后，可以快速使用backupCheckpointDir恢复数据</p></li> <li><p>Sink：HDFS Sink</p> <p>（1）HDFS存入大量小文件，有什么影响？</p> <p>**元数据层面：**每个小文件都有一份元数据，其中包括文件路径，文件名，所有者，所属组，权限，创建时间等，这些信息都保存在Namenode内存中。所以小文件过多，会占用Namenode服务器大量内存，影响Namenode性能和使用寿命</p> <p>**计算层面：**默认情况下MR会对每个小文件启用一个Map任务计算，非常影响计算性能。同时也影响磁盘寻址时间。</p> <p>（2）<strong>HDFS小文件处理</strong></p> <p>官方默认的这三个参数配置写入HDFS后会产生小文件，hdfs.rollInterval、hdfs.rollSize、hdfs.rollCount</p> <p>基于以上<strong>hdfs.rollInterval=3600，hdfs.rollSize=134217728，hdfs.rollCount =0</strong>几个参数综合作用，效果如下：</p> <p>（1）文件在达到128M时会滚动生成新文件</p> <p>（2）文件创建超3600秒时会滚动生成新文件</p></li></ol> <h3 id="日志消费flume启动脚本"><a href="#日志消费flume启动脚本" class="header-anchor">#</a> 日志消费Flume启动脚本</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /home/atguigu/bin
<span class="token function">vim</span> f2.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop104
        <span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------启动 <span class="token variable">$i</span> 消费flume-------&quot;</span>
                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;nohup /opt/module/flume/bin/flume-ng agent --conf-file /opt/module/flume/conf/kafka-flume-hdfs.conf --name a1 -Dflume.root.logger=INFO,LOGFILE &gt;/opt/module/flume/log.txt   2&gt;&amp;1 &amp;&quot;</span>
        <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop104
        <span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot; --------停止 <span class="token variable">$i</span> 消费flume-------&quot;</span>
                <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;ps -ef | grep kafka-flume-hdfs | grep -v grep |awk '{print \<span class="token variable">$2</span>}' | xargs -n1 kill&quot;</span>
        <span class="token keyword">done</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> f2.sh
f2.sh start
f2.sh stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="flume内存优化"><a href="#flume内存优化" class="header-anchor">#</a> Flume内存优化</h3> <p><strong>如果启动消费Flume抛出如下异常则表示该机器最小内存不满足于Flume配置的最小启动内存</strong></p> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>ERROR hdfs.HDFSEventSink: process failed
java.lang.OutOfMemoryError: GC overhead limit exceeded
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们可以修改Flume的默认内存配置</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /opt/module/flume/conf/flume-env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#添加以下配置</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms100m -Xmx2000m -Dcom.sun.management.jmxremote&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>分发配置文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>xsync flume-env.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Flume内存参数设置及优化</strong></p> <ol><li>JVM heap一般设置为4G或更高，部署在单独的服务器上（4核8线程16G内存）</li> <li>-<strong>Xmx与-Xms最好设置一致，减少内存抖动带来的性能影响，如果设置不一致容易导致频繁fullgc</strong>。</li> <li>-Xms表示JVM Heap(堆内存)最小尺寸，初始分配；-Xmx 表示JVM Heap(堆内存)最大允许的尺寸，按需分配。如果不设置一致，容易在初始化时，由于内存不够，频繁触发fullgc。</li></ol> <h2 id="采集通道启动-停止脚本"><a href="#采集通道启动-停止脚本" class="header-anchor">#</a> 采集通道启动/停止脚本</h2> <p><strong>该脚本控制全部组件的启动和停止</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /home/atguigu/bin
<span class="token function">vim</span> cluster.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意要先启动zookeeper再起kafka 关闭时候先关kafka再关zookeeper</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot; -------- 启动 集群 -------&quot;</span>

	<span class="token builtin class-name">echo</span> <span class="token string">&quot; -------- 启动 hadoop集群 -------&quot;</span>
	/opt/module/hadoop-3.1.3/sbin/start-dfs.sh 
	<span class="token function">ssh</span> hadoop103 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/start-yarn.sh&quot;</span>

	<span class="token comment">#启动 Zookeeper集群</span>
	zk.sh start

<span class="token function">sleep</span> 4s<span class="token punctuation">;</span>

	<span class="token comment">#启动 Flume采集集群</span>
	f1.sh start

	<span class="token comment">#启动 Kafka采集集群</span>
	kf.sh start

<span class="token function">sleep</span> 6s<span class="token punctuation">;</span>

	<span class="token comment">#启动 Flume消费集群</span>
	f2.sh start

	<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot; -------- 停止 集群 -------&quot;</span>


    <span class="token comment">#停止 Flume消费集群</span>
	f2.sh stop

	<span class="token comment">#停止 Kafka采集集群</span>
	kf.sh stop

    <span class="token function">sleep</span> 6s<span class="token punctuation">;</span>

	<span class="token comment">#停止 Flume采集集群</span>
	f1.sh stop

	<span class="token comment">#停止 Zookeeper集群</span>
	zk.sh stop

	<span class="token builtin class-name">echo</span> <span class="token string">&quot; -------- 停止 hadoop集群 -------&quot;</span>
	<span class="token function">ssh</span> hadoop103 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh&quot;</span>
	/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh 
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">chmod</span> <span class="token number">755</span> cluster.sh
cluster.sh start
cluster.sh stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="采集模块总结"><a href="#采集模块总结" class="header-anchor">#</a> 采集模块总结</h2> <h3 id="linux-shell相关总结"><a href="#linux-shell相关总结" class="header-anchor">#</a> Linux&amp;Shell相关总结</h3> <p>Linux常用高级命令</p> <table><thead><tr><th>序号</th> <th>命令</th> <th>命令解释</th></tr></thead> <tbody><tr><td>1</td> <td>top</td> <td>查看内存</td></tr> <tr><td>2</td> <td>df -h</td> <td>查看磁盘存储情况</td></tr> <tr><td>3</td> <td>iotop</td> <td>查看磁盘IO读写(yum  install iotop安装）</td></tr> <tr><td>4</td> <td>iotop -o</td> <td>直接查看比较高的磁盘读写程序</td></tr> <tr><td>5</td> <td>netstat -tunlp |  grep 端口号</td> <td>查看端口占用情况</td></tr> <tr><td>6</td> <td>uptime</td> <td>查看报告系统运行时长及平均负载</td></tr> <tr><td>7</td> <td>ps aux</td> <td>查看进程</td></tr></tbody></table> <p>Shell常用工具</p> <p>awk、sed、cut、sort</p> <h3 id="hadoop相关总结"><a href="#hadoop相关总结" class="header-anchor">#</a> Hadoop相关总结</h3> <ol><li><p><strong>Hadoop默认不支持LZO压缩，如果需要支持LZO压缩，需要添加jar包，并在hadoop的cores-site.xml文件中添加相关压缩配置。需要掌握让LZO文件支持切片。</strong></p></li> <li><p>Hadoop常用端口号，50070，8088，19888，9000</p></li> <li><p>Hadoop配置文件以及简单的Hadoop集群搭建。8个配置文件</p> <p>core-site.xml hdfs-site.xml yarn-site.xml mapred-site.xml workers（2.7为slaves）</p></li> <li><p>默认块大小</p> <ul><li>集群模式 128m</li> <li>本地模式 32m</li> <li>hadoop1.x  64m</li> <li>在业务开发中hdfs块大小通常设置为 128m或256m</li> <li>hive的文件块大小 256m</li></ul></li> <li><p>小文件问题</p> <ol><li><p>危害</p> <ul><li>占用namenode内存 一个文件块占用namenode 150字节</li> <li>增加切片数 每个文件开启一个maptask(默认内存为1g)</li></ul></li> <li><p>解决办法</p> <ul><li>har归档 自定义FileInputFormat</li> <li>combineInputformat 减少切片个数，进而减少的是maptask</li> <li>开启JVM重用</li></ul></li></ol></li> <li><p>MapReduce</p> <ul><li>shuffle优化</li> <li>map方法之后 reduce方法之前 混洗过程</li></ul></li> <li><p>Yarn</p> <ol><li><p>工作机制</p></li> <li><p>调度器</p> <ol><li><p>FIFO、容量、公平调度器  Apache默认调度器：容量  CDH默认调度器：公平调度器</p></li> <li><p>FIFO调度器特点：单队列，先进先出，在企业开发中没人使用</p></li> <li><p>容量调度器：支持多队列，先进来的任务优先享有资源</p></li> <li><p>公平调度器：支持多队列，每个任务公平享有资源  并发度最高。</p></li> <li><p>对并发度要求比较高，同时机器性能比较好，选择公平； 大公司
如果并发度不高，机器性能比较差，选择容量： 中小公司</p></li> <li><p>生产环境下队列怎么创建？
容量调度器默认只有一个default队列；
按照框架名称：hive、spark、flink</p> <p>按照业务名称：登录、购物车、支付模块、部门1、部门2  （居多）</p> <p>好处：解耦、降低风险、可以实现任务降级（部门1》部门2》购物车）</p></li></ol></li></ol></li></ol> <h3 id="flme相关总结"><a href="#flme相关总结" class="header-anchor">#</a> Flme相关总结</h3> <h4 id="组成"><a href="#组成" class="header-anchor">#</a> 组成</h4> <p>Flume组成，Put事务，Take事务</p> <p>​    Taildir Source：断点续传、多目录。Flume1.6以前需要自己自定义Source记录每次读取文件位置，实现断点续传。</p> <p>​    File Channel：数据存储在磁盘，宕机数据可以保存。但是传输速率慢。适合对数据传输可靠性要求高的场景，比如，金融行业。</p> <p>​    Memory Channel：数据存储在内存中，宕机数据丢失。传输速率快。适合对数据传输可靠性要求不高的场景，比如，普通的日志数据。</p> <p>​    Kafka Channel：减少了Flume的Sink阶段，提高了传输效率。</p> <p>​    Source到Channel是Put事务</p> <p>​    Channel到Sink是Take事务</p> <h5 id="taildir-source"><a href="#taildir-source" class="header-anchor">#</a> taildir source</h5> <ol><li>断点续传、多目录</li> <li>在Apache flume1.7之后产生的；如果是CDH，1.6之后；</li> <li>自定义source实现断点续传的功能（只要能自定义，有很多想象空间了）</li> <li>taildir source挂了怎么办？  不会丢失、可能产生数据重复</li> <li>对重复数据怎么处理？ 不处理；
处理：（自身：自定义source实现事务，额外增加了运算量）
<ol><li>在下一级处理：hive的数仓里面（dwd层，数据清洗ETL）</li> <li>spark Streaming里面处理  去重的手段：group by （id）   开窗（id）,只取窗口第一条</li></ol></li> <li>是否支持递归读取文件？  不支持；自定义tail source(递归+读取)    消费kafka+上传hdfs</li></ol> <h5 id="channel"><a href="#channel" class="header-anchor">#</a> channel</h5> <ol><li>File Channel :基于磁盘、效率低、可靠性高</li> <li>memoryChannel：基于内存、效率高、可靠性低</li> <li>KafkaChannel：数据存储在Kafka里面，基于磁盘、效率高于memoryChannel+kafkasink,因为省了sink
flume1.6时  topic + 内容； 无论true还是false都不起作用； bug
flume1.7解决bug,被大家广泛使用；</li> <li>在生产环境：如果下一级是kafka的话，优先选择KafkaChannel；
如果不是kafka，如果更关心可靠性选择FileChannel；如果更关心性能，选择memoryChannel</li></ol> <h5 id="hdfs-sink"><a href="#hdfs-sink" class="header-anchor">#</a> HDFS sink</h5> <ol><li><p>控制小文件：</p> <p>时间（1-2小时）、大小（128m）、event个数(0禁止)</p></li> <li><p>压缩</p> <p>开启压缩流；指定压缩编码方式（lzop/snappy）</p></li></ol> <h4 id="拦截器"><a href="#拦截器" class="header-anchor">#</a> 拦截器</h4> <ol><li><p>ETL（判断json的完整性 { }； 服务器时间（13  全数字）） 项目中自定义了：ETL拦截器和区分类型拦截器。 用两个拦截器的优缺点：优点，模块化开发和可移植性；缺点，性能会低一些</p></li> <li><p>分类型（启动日志、事件日志） kafka（的topic要满足下一级所又消费者）  一张表一个topic</p> <div class="language- extra-class"><pre><code>商品列表、商品详情、商品点击
广告
点赞、评论、收藏
后台活跃、通知
故障
启动日志
</code></pre></div></li> <li><p>自定义拦截器步骤</p> <ol><li>定义一个类  实现interceptor接口</li> <li>重写4个方法：初始化、关闭、单event、多event（）
<ul><li>initialize 初始化</li> <li>public Event intercept(Event event) 处理单个Event</li> <li>public List<code>&lt;Event&gt;</code> intercept(List<code>&lt;Event&gt;</code> events) 处理多个Event，在这个方法中调用Event intercept(Event event)</li> <li>close 方法</li></ul></li> <li>创建一个静态内部类Builder
<ul><li>静态内部类，实现Interceptor.Builder</li></ul></li></ol></li> <li><p>拦截器不要行不行？  看具体业务需求决定</p></li></ol> <h4 id="选择器"><a href="#选择器" class="header-anchor">#</a> 选择器</h4> <p><img src="https://cdn.jsdelivr.net/gh/Iekrwh/images/md-images/image-20220414220614503.png" alt="image-20220414220614503"></p> <p>rep（默认）  mul（选择性发往下一级通道）</p> <h4 id="监控器"><a href="#监控器" class="header-anchor">#</a> 监控器</h4> <p>ganglia  发现尝试提交的次数 远远大于最终提交成功次数； 说明flume性能不行；</p> <p>自身；提高自己的内存 4-6g  flume_env.sh
外援：增加flume台数  服务器配置（16g/32g  8T）</p> <h4 id="flume-内存"><a href="#flume-内存" class="header-anchor">#</a> Flume 内存</h4> <p>开发中在flume-env.sh中设置JVM heap为4G或更高，部署在单独的服务器上（4核8线程16G内存）</p> <p>-Xmx与-Xms最好设置一致，减少内存抖动带来的性能影响，如果设置不一致容易导致频繁fullgc。</p> <p>-Xms表示JVM Heap(堆内存)最小尺寸，初始分配；-Xmx 表示JVM Heap(堆内存)最大允许的尺寸，按需分配。如果不设置一致，容易在初始化时，由于内存不够，频繁触发fullgc。</p> <h4 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h4> <ol><li><p>File Channel   能多目录就多目录（要求在不同的磁盘），提高吞吐量 checkpointDir和backupCheckpointDir也尽量配置在不同硬盘对应的目录中，保证checkpoint坏掉后，可以快速使用backupCheckpointDir恢复数据</p></li> <li><p>控制小文件； 时间（1-2小时）、大小（128m）、event个数(0禁止)</p> <ol><li>HDFS存入大量小文件，有什么影响？</li></ol> <p>**元数据层面：**每个小文件都有一份元数据，其中包括文件路径，文件名，所有者，所属组，权限，创建时间等，这些信息都保存在Namenode内存中。所以小文件过多，会占用Namenode服务器大量内存，影响Namenode性能和使用寿命</p> <p>**计算层面：**默认情况下MR会对每个小文件启用一个Map任务计算，非常影响计算性能。同时也影响磁盘寻址时间。</p> <ol start="2"><li>HDFS小文件处理</li></ol> <p>官方默认的这三个参数配置写入HDFS后会产生小文件，hdfs.rollInterval、hdfs.rollSize、hdfs.rollCount</p> <p>基于以上hdfs.rollInterval=3600，hdfs.rollSize=134217728，hdfs.rollCount =0几个参数综合作用，效果如下：</p> <p>（1）文件在达到128M时会滚动生成新文件</p> <p>（2）文件创建超3600秒时会滚动生成新文件</p></li> <li><p>监控器</p></li></ol> <h4 id="flume采集数据会丢失吗"><a href="#flume采集数据会丢失吗" class="header-anchor">#</a> Flume采集数据会丢失吗?</h4> <p>不会，Channel存储可以存储在File中，数据传输自身有事务。</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/Iekrwh/blog-VuePress-theme-vdoing/edit/master/docs/02.大数据/11.离线数仓/04.数据采集模块.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/02, 18:25:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/13deb1/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">数据生成模块</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/13deb1/" class="prev">数据生成模块</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/a6064c/"><div>
            大数据
            <!----></div></a> <span class="date">07-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/13be6a/"><div>
            408
            <!----></div></a> <span class="date">07-22</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1e3dfc/"><div>
            Java
            <!----></div></a> <span class="date">07-22</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:iekr_wh@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Iekrwh" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="http://music.163.com/album?id=73927024" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Iekr | Blog <br> <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备2022039661号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><!----><div id="tcomment"></div></div></div>
    <script src="/assets/js/app.29dbd2a9.js" defer></script><script src="/assets/js/2.f9007d12.js" defer></script><script src="/assets/js/250.7aa4f12d.js" defer></script><script src="/assets/js/3.e376f0de.js" defer></script><script src="/assets/js/6.272c66f1.js" defer></script>
  </body>
</html>
